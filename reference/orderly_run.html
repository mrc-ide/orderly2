<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run a report — orderly_run • orderly2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run a report — orderly_run"><meta name="description" content="Run a report.  This will create a new directory in
drafts/&amp;lt;reportname&amp;gt;, copy your declared resources there, run
your script and check that all expected artefacts were created."><meta property="og:description" content="Run a report.  This will create a new directory in
drafts/&amp;lt;reportname&amp;gt;, copy your declared resources there, run
your script and check that all expected artefacts were created."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run a report</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/R/run.R" class="external-link"><code>R/run.R</code></a></small>
      <div class="d-none name"><code>orderly_run.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run a report.  This will create a new directory in
<code>drafts/&lt;reportname&gt;</code>, copy your declared resources there, run
your script and check that all expected artefacts were created.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_run</span><span class="op">(</span></span>
<span>  <span class="va">name</span>,</span>
<span>  parameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  envir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  location <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  allow_remote <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fetch_metadata <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  search_options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>Name of the report to run. Any leading <code>./</code> <code>src/</code> or
trailing <code>/</code> path parts will be removed (e.g., if added by
autocomplete).</p></dd>


<dt id="arg-parameters">parameters<a class="anchor" aria-label="anchor" href="#arg-parameters"></a></dt>
<dd><p>Parameters passed to the report. A named list of
parameters declared in the <code>orderly.yml</code>.  Each parameter
must be a scalar character, numeric, integer or logical.</p></dd>


<dt id="arg-envir">envir<a class="anchor" aria-label="anchor" href="#arg-envir"></a></dt>
<dd><p>The environment that will be used to evaluate the
report script; by default we use the global environment, which
may not always be what is wanted.</p></dd>


<dt id="arg-echo">echo<a class="anchor" aria-label="anchor" href="#arg-echo"></a></dt>
<dd><p>Optional logical to control printing output from
<code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> to the console.</p></dd>


<dt id="arg-location">location<a class="anchor" aria-label="anchor" href="#arg-location"></a></dt>
<dd><p>Optional vector of locations to pull from. We
might in future expand this to allow wildcards or exceptions.</p></dd>


<dt id="arg-allow-remote">allow_remote<a class="anchor" aria-label="anchor" href="#arg-allow-remote"></a></dt>
<dd><p>Logical, indicating if we should allow packets
to be found that are not currently unpacked (i.e., are known
only to a location that we have metadata from). If this is
<code>TRUE</code>, then in conjunction with <a href="orderly_dependency.html">orderly_dependency</a>
you might pull a large quantity of data.  The default is <code>NULL</code>. This is
<code>TRUE</code> if remote locations are listed explicitly as a character
vector in the <code>location</code> argument, or if you have specified
<code>fetch_metadata = TRUE</code>, otherwise <code>FALSE</code>.</p></dd>


<dt id="arg-fetch-metadata">fetch_metadata<a class="anchor" aria-label="anchor" href="#arg-fetch-metadata"></a></dt>
<dd><p>Logical, indicating if we should pull
metadata immediately before the search. If <code>location</code> is given,
then we will pass this through to
<a href="orderly_location_fetch_metadata.html">orderly_location_fetch_metadata</a> to filter locations
to update.  If pulling many packets in sequence, you <em>will</em> want
to update this option to <code>FALSE</code> after the first pull, otherwise
it will update the metadata between every packet, which will be
needlessly slow.</p></dd>


<dt id="arg-search-options">search_options<a class="anchor" aria-label="anchor" href="#arg-search-options"></a></dt>
<dd><p><strong>DEPRECATED</strong>. Please don't use this any
more, and instead use the arguments <code>location</code>, <code>allow_remote</code>
and <code>fetch_metadata</code> directly.</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>The path to the root directory, or <code>NULL</code> (the
default) to search for one from the current working
directory. This function <strong>does</strong> require that the directory is
configured for orderly, and not just outpack (see
<a href="orderly_init.html">orderly_init</a> for details).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The id of the created report (a string)</p>
    </div>
    <div class="section level2">
    <h2 id="locations-used-in-dependency-resolution">Locations used in dependency resolution<a class="anchor" aria-label="anchor" href="#locations-used-in-dependency-resolution"></a></h2>



<p>If your packet depends on other packets, you will want to control
the locations that are used to find appropriate packets. The
control for this is passed through this function and <em>not</em> as an
argument to <a href="orderly_dependency.html">orderly_dependency</a> because this is a
property of the way that a packet is created and not of a packet
itself; importantly different users may have different names for
their locations so it makes little sense to encode the location
name into the source code. Alternatively, you want to use
different locations in different contexts (initial development
where you want to include local copies packets as possible
dependencies vs resolving dependencies only as they would be
resolved on one of your locations!</p>
<p>Similarly, you might want to include packets that are known by
other locations but are not currently downloaded onto this
machine - pulling these packets in could take anything from
seconds to hours depending on their size and the speed of your
network connection (but <em>not</em> pulling in the packets could mean
that your packet fails to run).</p>
<p>To allow for control over this you can pass in an arguments to
control the names of the locations to use, whether metadata
should be refreshed before we pull anything and if packets that
are not currently downloaded should be considered candidates.</p>
<p>This has no effect when running interactively, in which case you
can specify the search options (root specific) with
<a href="orderly_interactive_set_search_options.html">orderly_interactive_set_search_options</a></p>
    </div>
    <div class="section level2">
    <h2 id="which-packets-might-be-selected-from-locations-">Which packets might be selected from locations?<a class="anchor" aria-label="anchor" href="#which-packets-might-be-selected-from-locations-"></a></h2>



<p>The arguments <code>location</code>, <code>allow_remote</code> and <code>fetch_metadata</code>
control where outpack searches for packets with the given query
and if anything might be moved over the network (or from one
outpack archive to another). By default everything is resolved
locally only; that is we can only depend on packets that are
unpacked within our current archive.  If you pass <code>allow_remote = TRUE</code>, then packets that are known anywhere are candidates for
using as dependencies and <em>if needed</em> we will pull the resolved
files from a remote location. Note that even if the packet is
not locally present this might not be needed - if you have the
same content anywhere else in an unpacked packet we will reuse
the same content without re-fetching.</p>
<p>If <code>fetch_metadata = TRUE</code>, then we will refresh location metadata
before pulling, and the <code>location</code> argument controls which
locations are pulled from.</p>
    </div>
    <div class="section level2">
    <h2 id="equivalence-to-the-old-use-draft-option">Equivalence to the old <code>use_draft</code> option<a class="anchor" aria-label="anchor" href="#equivalence-to-the-old-use-draft-option"></a></h2>



<p>The above location handling generalises orderly (v1)'s old
<code>use_draft</code> option, in terms of the new <code>location</code> argument:</p><ul><li><p><code>use_draft = TRUE</code> is <code>location = "local"</code></p></li>
<li><p><code>use_draft = FALSE</code> is <code>location = c(...)</code> where you should provide
all locations <em>except</em> local
(<code>setdiff(orderly_location_list(), "local")</code>)</p></li>
<li><p><code>use_draft = "newer"</code> is <code>location = NULL</code></p></li>
</ul><p>(this last option was the one most people preferred so is the new
default behaviour). In addition, you could resolve dependencies
as they currently exist on production right now with the options:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>location <span class="ot">=</span> <span class="st">"production"</span>, fetch_metadata <span class="ot">=</span> <span class="cn">TRUE</span></span></code></pre><p></p></div>
<p>which updates your current metadata from production, then runs
queries against only packets known on that remote, then depends
on them even if you don't (yet) have them locally.  This
functionality was never available in orderly version 1, though
we had intended to support it.</p>
    </div>
    <div class="section level2">
    <h2 id="running-with-a-source-tree-separate-from-outpack-root">Running with a source tree separate from outpack root<a class="anchor" aria-label="anchor" href="#running-with-a-source-tree-separate-from-outpack-root"></a></h2>



<p>Sometimes it is useful to run things from a different place on
disk to your outpack root. We know of two cases where this has
come up:</p><ul><li><p>when running reports within a runner on a server, we make a
clean clone of the source tree at a particular git reference
into a new temporary directory and then run the report there,
but have it insert into an orderly repo at a fixed and
non-temporary location.</p></li>
<li><p>we have a user for whom it is more convenient to run their report
on a hard drive but store the archive and metadata on a (larger)
shared drive.</p></li>
</ul><p>In the first instance, we have a source path at <code>&lt;src&gt;</code> which
contains the file <code>orderly_config.yml</code> and the directory <code>src/</code>
with our source reports, and a separate path <code>&lt;root&gt;</code> which
contains the directory <code>.outpack/</code> with all the metadata - it
may also have an unpacked archive, and a <code>.git/</code> directory
depending on the configuration. (Later this will make more sense
once we support a "bare" outpack layout.)</p>
    </div>
    <div class="section level2">
    <h2 id="manually-setting-report-source-directory">Manually setting report source directory<a class="anchor" aria-label="anchor" href="#manually-setting-report-source-directory"></a></h2>



<p>To manually set the report source directory, you will need to set
the path of the directory as the <code>ORDERLY_REPORT_SRC</code> environment
variable.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a simple example:</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/Rtmp6Hh44x/orderly2_ex_1d3e157f6098'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run the 'data' task:</span></span></span>
<span class="r-in"><span><span class="fu">orderly_run</span><span class="op">(</span><span class="st">"data"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20250901-150652-db88b42d` at 2025-09-01 15:06:52.862042</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_description(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +   display = "A demo data set")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; x &lt;- jitter(1:30)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; y &lt;- 0.4 * x + 5 + rnorm(length(x), sd = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; d &lt;- data.frame(x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_artefact("data.rds", description = "A synthetic dataset")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; saveRDS(d, "data.rds")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150652-db88b42d at 2025-09-01 15:06:52.887085 (0.0250423 secs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "20250901-150652-db88b42d"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># After running, a finished packet appears in the archive:</span></span></span>
<span class="r-in"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB; font-weight: bold;">/tmp/Rtmp6Hh44x/orderly2_ex_1d3e157f6098</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── <span style="color: #0000BB; font-weight: bold;">archive</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │   └── <span style="color: #0000BB; font-weight: bold;">data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │       └── <span style="color: #0000BB; font-weight: bold;">20250901-150652-db88b42d</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │           ├── <span style="color: #00BB00;">data.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │           └── data.rds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── <span style="color: #0000BB; font-weight: bold;">draft</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │   └── <span style="color: #0000BB; font-weight: bold;">data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── orderly_config.yml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── <span style="color: #0000BB; font-weight: bold;">shared</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │   └── <span style="color: #00BB00;">palette.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> └── <span style="color: #0000BB; font-weight: bold;">src</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">data.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">depends</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">depends.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">parameters</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">parameters.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">run_info</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">run_info.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">shared</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">shared.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     └── <span style="color: #0000BB; font-weight: bold;">strict</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         └── <span style="color: #00BB00;">strict.R</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and we can query the metadata:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="orderly_metadata_extract.html">orderly_metadata_extract</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"data"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         id name parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 20250901-150652-db88b42d data           </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

