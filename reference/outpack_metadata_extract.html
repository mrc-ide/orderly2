<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Extract metadata from orderly2 packets — outpack_metadata_extract • orderly2</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Extract metadata from orderly2 packets — outpack_metadata_extract"><meta property="og:description" content="Extract metadata from a group of packets.  This is an
experimental high-level function for interacting with the
metadata in a way that we hope will be useful. We'll expand this a
bit as time goes on, based on feedback we get so let us know what
you think.  See Details for how to use this."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orderly2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.99.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/orderly2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction.html">Introduction to orderly2</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Outpack metadata</a>
    </li>
    <li>
      <a href="../articles/migrating.html">Migrating from orderly (1.x)</a>
    </li>
    <li>
      <a href="../articles/plugins.html">Orderly plugins</a>
    </li>
    <li>
      <a href="../articles/query.html">Outpack query DSL</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mrc-ide/orderly2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract metadata from orderly2 packets</h1>
    <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/HEAD/R/outpack_tools.R" class="external-link"><code>R/outpack_tools.R</code></a></small>
    <div class="hidden name"><code>outpack_metadata_extract.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extract metadata from a group of packets.  This is an
<strong>experimental</strong> high-level function for interacting with the
metadata in a way that we hope will be useful. We'll expand this a
bit as time goes on, based on feedback we get so let us know what
you think.  See Details for how to use this.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">outpack_metadata_extract</span><span class="op">(</span><span class="va">...</span>, extract <span class="op">=</span> <span class="cn">NULL</span>, root <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>...</dt>
<dd><p>Arguments passed through to <a href="outpack_search.html">outpack_search</a>. In the
special case where the first argument is a character vector of
ids <em>and</em> there are no named dot arguments, then we interpret
this argument as a vector of ids directly.</p></dd>


<dt>extract</dt>
<dd><p>A character vector of columns to extract, possibly
named. See Details for the format.</p></dd>


<dt>root</dt>
<dd><p>The outpack root. Will be searched for from the
current directory if not given.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>data.frame</code>, the columns of which vary based on the
names of <code>extract</code>; see Details for more information.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Extracting data from outpack metadata is challenging to do in a
way that works in data structures familiar to R users, because it
is naturally tree structured, and because not all metadata may be
present in all packets (e.g., a packet that does not depend on
another will not have a dependency section, and one that was run
in a context without git will not have git metadata). If you just
want the raw tree-structured data, you can always use
<a href="outpack_metadata.html">outpack_metadata</a> to load the full metadata for any
packet (even one that is not currently available on your computer,
just known about it) and the structure of the data will remain
fairly constant across orderly2 versions.</p>
<p>However, sometimes we want to extract data in order to ask
specific questions like:</p><ul><li><p>what parameter combinations are available across a range of packets?</p></li>
<li><p>when were a particular set of packets used?</p></li>
<li><p>what files did these packets produce?</p></li>
</ul><p>Later we'd like to ask even more complex questions like:</p><ul><li><p>at what version did the file <code>graph.png</code> change?</p></li>
<li><p>what inputs changed between these versions?</p></li>
</ul><p>...but being able to answer these questions requires a similar
approach to interrogating metadata across a range of packets.</p>
<p>The <code>outpack_metadata_extract</code> function aims to simplify the
process of pulling out bits of metadata and arranging it into a
<code>data.frame</code> (of sorts) for you.  It has a little mini-language in
the <code>extract</code> argument for doing some simple rewriting of results,
but you can always do this yourself.</p>
<p>In order to use function you need to know what metadata are
available; we will expand the vignette with more worked examples
here to make this easier to understand. The function works on
top-level keys, of which there are:</p><ul><li><p>id: the packet id (this is always returned)</p></li>
<li><p>name: the packet name</p></li>
<li><p>parameters: a key-value pair of values, with string keys and
atomic values. There is no guarantee about presence of keys
between packets, or their types.</p></li>
<li><p>time: a key-value pair of times, with string keys and time
values (see <a href="https://rdrr.io/r/base/DateTimeClasses.html" class="external-link">DateTimeClasses</a>; these are stored as seconds since
1970 in the actual metadata). At present <code>start</code> and <code>end</code> are
always present.</p></li>
<li><p>files: files present in each packet. This is a <code>data.frame</code> (per
packet), each with columns <code>path</code> (relative), <code>size</code> (in bytes)
and <code>hash</code>.</p></li>
<li><p>depends: dependencies used each packet. This is a <code>data.frame</code>
(per packet), each with columns <code>packet</code> (id), <code>query</code> (string,
used to find <code>packet</code>) and <code>files</code> (another <code>data.frame</code> with
columns <code>there</code> and <code>here</code> corresponding to filenames upstream
and in this packet, respectively)</p></li>
<li><p>git: either metadata about the state of git or <code>null</code>. If given
then <code>sha</code> and <code>branch</code> are strings, while <code>url</code> is an array of
strings/character vector (can have zero, one or more elements).</p></li>
<li><p>session: some information about the session that the packet was run in
(this is unstandardised, and even the orderly version may change)</p></li>
<li><p>custom: additional metadata added by its respective engine.  For
packets run by <code>orderly2</code>, there will be a <code>orderly</code> field here,
which is itself a list (see below)</p></li>
</ul><p>The nesting here makes providing a universally useful data format
difficult; if considering files we have a <code>data.frame</code> with a
<code>files</code> column, which is a list of <code>data.frame</code>s; similar
nestedness applies to <code>depends</code> and the orderly custom
data. However, you should be able to fairly easily process the
data into the format you need it in.</p>
<p>The simplest extraction uses names of top-level keys:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"parameters"</span>, <span class="st">"files"</span>)</span></code></pre><p></p></div>
<p>This creates a data.frame with columns corresponding to these
keys, one row per packet. Because <code>name</code> is always a string, it
will be a character vector, but because <code>parameters</code> and <code>files</code>
are more complex, these will be list columns.</p>
<p>You must not provide <code>id</code>; it is always returned and always first
as a character vector column.</p>
<p>You can rename the columns by providing a name to entries within
<code>extract</code>, for example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="at">pars =</span> <span class="st">"parameters"</span>, <span class="st">"files"</span>)</span></code></pre><p></p></div>
<p>is the same as above, except that that the <code>parameters</code> column has
been renamed <code>pars</code>.</p>
<p>More interestingly, we can index into a structure like
<code>parameters</code>; suppose we want the value of the parameter <code>x</code>, we
could write:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">=</span> <span class="fu">c</span>(<span class="at">x =</span> <span class="st">"parameters.x"</span>)</span></code></pre><p></p></div>
<p>which is allowed because for <em>each packet</em> the <code>parameters</code>
element is a list.</p>
<p>However, we do not know what type <code>x</code> is (and it might vary
between packets). We can add that information ourselves though and write:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">=</span> <span class="fu">c</span>(<span class="at">x =</span> <span class="st">"parameters.x is number"</span>)</span></code></pre><p></p></div>
<p>to create an numeric column. If any packet has a value of <code>x</code> that
is non-integer, your call to <code>outpack_metadata_extract</code> will fail
with an error, and if a packet lacks a value of <code>x</code>, a missing
value of the appropriate type will be added.</p>
<p>Note that this does not do any coersion to number, it will error
if a non-NULL non-numeric value is found.  Valid types for use
with <code>is &lt;type&gt;</code> are <code>boolean</code>, <code>number</code> and <code>string</code> (note that
these differ slightly from R's names because we want to emphasise
that these are <em>scalar</em> quantities; also note that there is no
<code>integer</code> here as this may produce unexpected errors with
integer-like numeric values). You can also use <code>list</code> but this is
the default.  Things in the schema that are known to be scalar
atomics (such as <code>name</code>) will be automatically simplified.</p>
<p>You can index into the array-valued elements (<code>files</code> and
<code>depends</code>) in the same way as for the object-valued elements:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">=</span> <span class="fu">c</span>(<span class="at">file_path =</span> <span class="st">"files.path"</span>, <span class="at">file_hash =</span> <span class="st">"files.hash"</span>)</span></code></pre><p></p></div>
<p>would get you a list column of file names per packet and another
of hashes, but this is probably less useful than the <code>data.frame</code>
you'd get from extracting just <code>files</code> because you no longer have
the hash information aligned.</p>
<p>You can index fairly deeply; it should be possible to get the
orderly "display name" with:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">=</span> <span class="fu">c</span>(<span class="at">display =</span> <span class="st">"custom.orderly.description.display is string"</span>)</span></code></pre><p></p></div>
    </div>
    <div id="custom-orderly-metadata">
    <h2>Custom 'orderly' metadata</h2>
    


<p>Within <code>custom.orderly</code>, additional fields can be extracted. The
format of this is subject to change, both in the stored metadata
and schema (in the short term) and in the way we deserialise it.
It is probably best not to rely on this right now, and we will
expand this section when you can.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

