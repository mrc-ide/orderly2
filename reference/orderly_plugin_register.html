<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Register an orderly plugin — orderly_plugin_register • orderly2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Register an orderly plugin — orderly_plugin_register"><meta name="description" content='Create an orderly plugin. A plugin is typically defined by a
package and is used to extend orderly by enabling new
functionality, declared in orderly_config.yml and your orderly file,
and affecting the running of reports primarily by creating new
objects in the report environment.  This system is discussed in
more detail in vignette("plugins"), but will be expanded (likely
in breaking ways) soon.'><meta property="og:description" content='Create an orderly plugin. A plugin is typically defined by a
package and is used to extend orderly by enabling new
functionality, declared in orderly_config.yml and your orderly file,
and affecting the running of reports primarily by creating new
objects in the report environment.  This system is discussed in
more detail in vignette("plugins"), but will be expanded (likely
in breaking ways) soon.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Register an orderly plugin</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/R/plugin.R" class="external-link"><code>R/plugin.R</code></a></small>
      <div class="d-none name"><code>orderly_plugin_register.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create an orderly plugin. A plugin is typically defined by a
package and is used to extend orderly by enabling new
functionality, declared in <code>orderly_config.yml</code> and your orderly file,
and affecting the running of reports primarily by creating new
objects in the report environment.  This system is discussed in
more detail in <code><a href="../articles/plugins.html">vignette("plugins")</a></code>, but will be expanded (likely
in breaking ways) soon.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_plugin_register</span><span class="op">(</span></span>
<span>  <span class="va">name</span>,</span>
<span>  <span class="va">config</span>,</span>
<span>  serialise <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  deserialise <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cleanup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  schema <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The name of the plugin, typically the package name</p></dd>


<dt id="arg-config">config<a class="anchor" aria-label="anchor" href="#arg-config"></a></dt>
<dd><p>A function to read, check and process the
configuration section in <code>orderly_config.yml</code>. This function
will be passed the deserialised data from the plugin's section
of <code>orderly_config.yml</code>, and the full path to that file.  As the
order of loading of plugins is not defined, each plugin must
standalone and should not try and interact with other plugins at
load. It should return a processed copy of the configuration
data, to be passed in as the second argument to <code>read</code>.</p></dd>


<dt id="arg-serialise">serialise<a class="anchor" aria-label="anchor" href="#arg-serialise"></a></dt>
<dd><p>A function to serialise any metadata added by the
plugin's functions to the outpack metadata. It will be passed a
list of all entries pushed in via
<code><a href="orderly_plugin_add_metadata.html">orderly_plugin_add_metadata()</a></code>; this is a named
list with names corresponding to the <code>field</code> argument to
<code>orderly_plugin_add_metadata</code> and each list element being an
unnamed list with values corresponding to <code>data</code>. If <code>NULL</code>,
then no serialisation is done, and no metadata from your plugin
will be added.</p></dd>


<dt id="arg-deserialise">deserialise<a class="anchor" aria-label="anchor" href="#arg-deserialise"></a></dt>
<dd><p>A function to deserialise any metadata
serialised by the <code>serialise</code> function. This is intended to help
deal with issues disambiguating unserialising objects from json
(scalars vs arrays of length 1, data.frames vs lists-of-lists
etc), and will make your plugin nicer to work with
<code><a href="orderly_metadata_extract.html">orderly_metadata_extract()</a></code>. This function will be
given a single argument <code>data</code> which is the data from
<code>jsonlite::fromJSON(..., simplifyVector = FALSE)</code> and you should
apply any required simplifications yourself, returning a
modified copy of the argument.</p></dd>


<dt id="arg-cleanup">cleanup<a class="anchor" aria-label="anchor" href="#arg-cleanup"></a></dt>
<dd><p>Optionally, a function to clean up any state that
your plugin uses. You can call <code>orderly_plugin_context</code> from
within this function and access anything you need from that. If
not given, then no cleanup is done.</p></dd>


<dt id="arg-schema">schema<a class="anchor" aria-label="anchor" href="#arg-schema"></a></dt>
<dd><p>Optionally a path, within the package, to a schema
for the metadata created by this plugin; you should omit the
<code>.json</code> extension.  So if your file contains in its sources the
file <code>inst/plugin/myschema.json</code> you would pass
<code>plugin/myschema</code>.  See <code><a href="../articles/plugins.html">vignette("plugins")</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Nothing, this function is called for its side effect of
registering a plugin.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># The example code from vignette("plugins") is available in the package</span></span></span>
<span class="r-in"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/example.db"</span>, package <span class="op">=</span> <span class="st">"orderly2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB; font-weight: bold;">/home/runner/work/_temp/Library/orderly2/examples/example.db</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── DESCRIPTION</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── NAMESPACE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── <span style="color: #0000BB; font-weight: bold;">R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │   └── <span style="color: #00BB00;">plugin.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> └── <span style="color: #0000BB; font-weight: bold;">inst</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     └── schema.json</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See orderly_plugin_register in context here:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="orderly_example_show.html">orderly_example_show</a></span><span class="op">(</span><span class="st">"R/plugin.R"</span>, example <span class="op">=</span> <span class="st">"example.db"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">R/plugin.R</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> db_config <span style="color: #D7AF00;">&lt;-</span> <span style="color: #AFAF00;">function</span><span style="color: #D7AF00;">(</span>data, filename<span style="color: #D7AF00;">)</span> <span style="color: #D7AF00;">{</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #AFAF00;">if</span> <span style="color: #BBBB00;">(</span><span style="color: #D7AF00;">!</span><span style="font-weight: bold;">is.list</span><span style="color: #0000BB;">(</span>data<span style="color: #0000BB;">)</span> <span style="color: #D7AF00;">||</span> <span style="font-weight: bold;">is.null</span><span style="color: #0000BB;">(</span><span style="font-weight: bold;">names</span><span style="color: #00BBBB;">(</span>data<span style="color: #00BBBB;">)</span><span style="color: #0000BB;">)</span> <span style="color: #D7AF00;">||</span> <span style="font-weight: bold;">length</span><span style="color: #0000BB;">(</span>data<span style="color: #0000BB;">)</span> <span style="color: #D7AF00;">==</span> <span style="color: #D75FAF;">0</span><span style="color: #BBBB00;">)</span> <span style="color: #BBBB00;">{</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     <span style="font-weight: bold;">stop</span><span style="color: #0000BB;">(</span><span style="color: #00AFAF;">"Expected a named list for orderly_config.yml:example.db"</span><span style="color: #0000BB;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #BBBB00;">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #AFAF00;">if</span> <span style="color: #BBBB00;">(</span><span style="font-weight: bold;">length</span><span style="color: #0000BB;">(</span>data<span style="color: #D7AF00;">$</span>path<span style="color: #0000BB;">)</span> != <span style="color: #D75FAF;">1</span> <span style="color: #D7AF00;">||</span> <span style="color: #D7AF00;">!</span><span style="font-weight: bold;">is.character</span><span style="color: #0000BB;">(</span>data<span style="color: #D7AF00;">$</span>path<span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span> <span style="color: #BBBB00;">{</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     <span style="font-weight: bold;">stop</span><span style="color: #0000BB;">(</span><span style="color: #00AFAF;">"Expected a string for orderly_config.yml:example.db:path"</span><span style="color: #0000BB;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #BBBB00;">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #AFAF00;">if</span> <span style="color: #BBBB00;">(</span><span style="color: #D7AF00;">!</span><span style="font-weight: bold;">file.exists</span><span style="color: #0000BB;">(</span>data<span style="color: #D7AF00;">$</span>path<span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span> <span style="color: #BBBB00;">{</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     <span style="font-weight: bold;">stop</span><span style="color: #0000BB;">(</span><span style="font-weight: bold;">sprintf</span><span style="color: #00BBBB;">(</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>       <span style="color: #00AFAF;">"The database '%s' does not exist (orderly_config:example.db:path)"</span>,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>       data<span style="color: #D7AF00;">$</span>path<span style="color: #00BBBB;">)</span><span style="color: #0000BB;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #BBBB00;">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #D7AF00;">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> query <span style="color: #D7AF00;">&lt;-</span> <span style="color: #AFAF00;">function</span><span style="color: #D7AF00;">(</span>sql<span style="color: #D7AF00;">)</span> <span style="color: #D7AF00;">{</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ctx <span style="color: #D7AF00;">&lt;-</span> orderly2::<span style="font-weight: bold;">orderly_plugin_context</span><span style="color: #BBBB00;">(</span><span style="color: #00AFAF;">"example.db"</span><span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   dbname <span style="color: #D7AF00;">&lt;-</span> ctx<span style="color: #D7AF00;">$</span>config<span style="color: #D7AF00;">$</span>path</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   con <span style="color: #D7AF00;">&lt;-</span> DBI::<span style="font-weight: bold;">dbConnect</span><span style="color: #BBBB00;">(</span>RSQLite::<span style="font-weight: bold;">SQLite</span><span style="color: #0000BB;">()</span>, dbname<span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">on.exit</span><span style="color: #BBBB00;">(</span>DBI::<span style="font-weight: bold;">dbDisconnect</span><span style="color: #0000BB;">(</span>con<span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   d <span style="color: #D7AF00;">&lt;-</span> DBI::<span style="font-weight: bold;">dbGetQuery</span><span style="color: #BBBB00;">(</span>con, sql<span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   info <span style="color: #D7AF00;">&lt;-</span> <span style="font-weight: bold;">list</span><span style="color: #BBBB00;">(</span>sql = sql, rows = <span style="font-weight: bold;">nrow</span><span style="color: #0000BB;">(</span>d<span style="color: #0000BB;">)</span>, cols = <span style="font-weight: bold;">names</span><span style="color: #0000BB;">(</span>d<span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   orderly2::<span style="font-weight: bold;">orderly_plugin_add_metadata</span><span style="color: #BBBB00;">(</span><span style="color: #00AFAF;">"example.db"</span>, <span style="color: #00AFAF;">"query"</span>, info<span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   d</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #D7AF00;">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> .onLoad <span style="color: #D7AF00;">&lt;-</span> <span style="color: #AFAF00;">function</span><span style="color: #D7AF00;">(</span>...<span style="color: #D7AF00;">)</span> <span style="color: #D7AF00;">{</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   orderly2::<span style="font-weight: bold;">orderly_plugin_register</span><span style="color: #BBBB00;">(</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     name = <span style="color: #00AFAF;">"example.db"</span>,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     config = db_config,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     serialise = db_serialise,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     deserialise = db_deserialise,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     schema = <span style="color: #00AFAF;">"schema.json"</span><span style="color: #BBBB00;">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #D7AF00;">}</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

