<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Copy files from a packet — orderly_copy_files • orderly2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Copy files from a packet — orderly_copy_files"><meta name="description" content="Copy files from a packet to anywhere. Similar to
orderly_dependency except that this is not used in an
active packet context. You can use this function to pull files
from an outpack root to a directory outside of the control of
outpack, for example. Note that all arguments need must be
provided by name, not position, with the exception of the id or
query."><meta property="og:description" content="Copy files from a packet to anywhere. Similar to
orderly_dependency except that this is not used in an
active packet context. You can use this function to pull files
from an outpack root to a directory outside of the control of
outpack, for example. Note that all arguments need must be
provided by name, not position, with the exception of the id or
query."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Copy files from a packet</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/R/outpack_helpers.R" class="external-link"><code>R/outpack_helpers.R</code></a></small>
      <div class="d-none name"><code>orderly_copy_files.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Copy files from a packet to anywhere. Similar to
<a href="orderly_dependency.html">orderly_dependency</a> except that this is not used in an
active packet context. You can use this function to pull files
from an outpack root to a directory outside of the control of
outpack, for example. Note that all arguments need must be
provided by name, not position, with the exception of the id or
query.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_copy_files</span><span class="op">(</span></span>
<span>  <span class="va">expr</span>,</span>
<span>  <span class="va">files</span>,</span>
<span>  <span class="va">dest</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  location <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  allow_remote <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fetch_metadata <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>The query expression. A <code>NULL</code> expression matches everything.</p></dd>


<dt id="arg-files">files<a class="anchor" aria-label="anchor" href="#arg-files"></a></dt>
<dd><p>Files to copy from the other packet, as a character vector.
If the character vector is unnamed, the files listed are copied over
without changing their names. If the vector is named however, the names
will be used as the destination name for the files.</p>
<p>In either case, if you want to import a directory of files from a
packet, you must refer to the source with a trailing slash
(e.g., <code>c(here = "there/")</code>), which will create the local
directory <code>here/...</code> with files from the upstream packet
directory <code>there/</code>. If you omit the slash then an error will be
thrown suggesting that you add a slash if this is what you
intended.</p>
<p>You can use a limited form of string interpolation in the names of
this argument; using <code>${variable}</code> will pick up values from
<code>envir</code> and substitute them into your string.  This is similar
to the interpolation you might be familiar with from
<code><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue::glue</a></code> or similar, but much simpler with no concatenation
or other fancy features supported.</p>
<p>Note that there is an unfortunate, but (to us) avoidable
inconsistency here; interpolation of values from your
environment in the query is done by using <code>environment:x</code> and in
the destination filename by doing <code>${x}</code>.</p>
<p>If you want to copy <em>all</em> files from the packet, use <code>./</code> (read
this as the directory of the packet).  The trailing slash is
required in order to be consistent with the rules above.</p></dd>


<dt id="arg-dest">dest<a class="anchor" aria-label="anchor" href="#arg-dest"></a></dt>
<dd><p>The directory to copy into</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Overwrite files at the destination; this is
typically what you want, but set to <code>FALSE</code> if you would prefer
that an error be thrown if the destination file already exists.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>Optionally, the name of the packet to scope the query on. This
will be intersected with <code>scope</code> arg and is a shorthand way of running
<code>scope = list(name = "name")</code></p></dd>


<dt id="arg-location">location<a class="anchor" aria-label="anchor" href="#arg-location"></a></dt>
<dd><p>Optional vector of locations to pull from. We
might in future expand this to allow wildcards or exceptions.</p></dd>


<dt id="arg-allow-remote">allow_remote<a class="anchor" aria-label="anchor" href="#arg-allow-remote"></a></dt>
<dd><p>Logical, indicating if we should allow packets
to be found that are not currently unpacked (i.e., are known
only to a location that we have metadata from). If this is
<code>TRUE</code>, then in conjunction with <a href="orderly_dependency.html">orderly_dependency</a>
you might pull a large quantity of data.  The default is <code>NULL</code>. This is
<code>TRUE</code> if remote locations are listed explicitly as a character
vector in the <code>location</code> argument, or if you have specified
<code>fetch_metadata = TRUE</code>, otherwise <code>FALSE</code>.</p></dd>


<dt id="arg-fetch-metadata">fetch_metadata<a class="anchor" aria-label="anchor" href="#arg-fetch-metadata"></a></dt>
<dd><p>Logical, indicating if we should pull
metadata immediately before the search. If <code>location</code> is given,
then we will pass this through to
<a href="orderly_location_fetch_metadata.html">orderly_location_fetch_metadata</a> to filter locations
to update.  If pulling many packets in sequence, you <em>will</em> want
to update this option to <code>FALSE</code> after the first pull, otherwise
it will update the metadata between every packet, which will be
needlessly slow.</p></dd>


<dt id="arg-parameters">parameters<a class="anchor" aria-label="anchor" href="#arg-parameters"></a></dt>
<dd><p>Optionally, a named list of parameters to substitute
into the query (using the <code>this:</code> prefix)</p></dd>


<dt id="arg-options">options<a class="anchor" aria-label="anchor" href="#arg-options"></a></dt>
<dd><p><strong>DEPRECATED</strong>. Please don't use this any more, and
instead use the arguments <code>location</code>, <code>allow_remote</code> and
<code>fetch_metadata</code> directly.</p></dd>


<dt id="arg-envir">envir<a class="anchor" aria-label="anchor" href="#arg-envir"></a></dt>
<dd><p>Optionally, an environment to substitute into the
query (using the <code>environment:</code> prefix). The default here is to
use the calling environment, but you can explicitly pass this in
if you want to control where this lookup happens.</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>The path to the root directory, or <code>NULL</code> (the
default) to search for one from the current working
directory. This function does not require that the directory is
configured for orderly, and can be any <code>outpack</code> root (see
<a href="orderly_init.html">orderly_init</a> for details).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Primarily called for its side effect of copying files from
a packet into the directory <code>dest</code>.  Also returns a list with
information about the copy, containing elements:</p><ul><li><p><code>id</code>: The resolved id of the packet</p></li>
<li><p><code>name</code>: The name of the packet</p></li>
<li><p><code>files</code>: a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> of filenames with columns <code>here</code>
(the name of the file in <code>dest</code>) and <code>there</code> (the name of the
file in the packet)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>You can call this function with an id as a string, in which case
we do not search for the packet and proceed regardless of whether
or not this id is present.  If called with any other arguments
(e.g., a string that does not match the id format, or a named
argument <code>name</code>, <code>subquery</code> or <code>parameters</code>) then we interpret the
arguments as a query and <a href="orderly_search.html">orderly_search</a> to find the
id. It is an error if this query does not return exactly one
packet id, so you probably want to use <code>latest()</code>.</p>
<p>There are different ways that this might fail (or recover from
failure):</p><ul><li><p>if <code>id</code> is not known in the metadata store (not known because
it's not unpacked but also not known to be present in some other
remote) then this will fail because it's impossible to resolve
the files. Consider refreshing the metadata with
<a href="orderly_location_fetch_metadata.html">orderly_location_fetch_metadata</a> to refresh this.</p></li>
<li><p>if the <code>id</code> is not unpacked <em>and</em> no local copy of the files
referred to can be found, we error by default (but see the next
option). However, sometimes the file you refer to might also be
present because you have downloaded a packet that depended on
it, or because the content of the file is unchanged because from
some other packet version you have locally.</p></li>
<li><p>if the <code>id</code> is not unpacked, there is no local copy of the file
and if <code>allow_remote</code> is <code>TRUE</code> we will try and request the file
from whatever remote would be selected by
<a href="orderly_location_pull.html">orderly_location_pull</a> for this packet.</p></li>
</ul><p>Note that empty directories might be created on failure.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/Rtmp6Hh44x/orderly2_ex_1d3e4085f257'</span>
<span class="r-in"><span><span class="fu"><a href="orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"data"</span>, root <span class="op">=</span> <span class="va">root</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20250901-150641-4289cfdc` at 2025-09-01 15:06:41.264421</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_description(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +   display = "A demo data set")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; x &lt;- jitter(1:30)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; y &lt;- 0.4 * x + 5 + rnorm(length(x), sd = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; d &lt;- data.frame(x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_artefact("data.rds", description = "A synthetic dataset")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; saveRDS(d, "data.rds")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150641-4289cfdc at 2025-09-01 15:06:41.29008 (0.02565956 secs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "20250901-150641-4289cfdc"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dest</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">orderly_copy_files</span><span class="op">(</span><span class="st">"latest"</span>, name <span class="op">=</span> <span class="st">"data"</span>, <span class="st">"data.rds"</span>,</span></span>
<span class="r-in"><span>                          dest <span class="op">=</span> <span class="va">dest</span>, root <span class="op">=</span> <span class="va">root</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We now have our data in the destination directory:</span></span></span>
<span class="r-in"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB; font-weight: bold;">/tmp/Rtmp6Hh44x/file1d3e5861ae17</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> └── data.rds</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Information about the copy:</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "20250901-150641-4289cfdc"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "data"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $files</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       here    there</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 data.rds data.rds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

