<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Clean up source directory — orderly_cleanup • orderly2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Clean up source directory — orderly_cleanup"><meta name="description" content="Find, and delete, file that were generated by running a report.
Until you're comfortable with what this will do, you are strongly
recommended to run orderly_cleanup_status first to see what will
be deleted."><meta property="og:description" content="Find, and delete, file that were generated by running a report.
Until you're comfortable with what this will do, you are strongly
recommended to run orderly_cleanup_status first to see what will
be deleted."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Clean up source directory</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/R/cleanup.R" class="external-link"><code>R/cleanup.R</code></a></small>
      <div class="d-none name"><code>orderly_cleanup.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Find, and delete, file that were generated by running a report.
Until you're comfortable with what this will do, you are strongly
recommended to run <code>orderly_cleanup_status</code> first to see what will
be deleted.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_cleanup</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, dry_run <span class="op">=</span> <span class="cn">FALSE</span>, root <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orderly_cleanup_status</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, root <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>Name of the report directory to clean (i.e., we look
at <code>src/&lt;name&gt;</code> relative to your orderly root</p></dd>


<dt id="arg-dry-run">dry_run<a class="anchor" aria-label="anchor" href="#arg-dry-run"></a></dt>
<dd><p>Logical, indicating if we should <em>not</em> delete
anything, but instead just print information about what we would
do</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>The path to the root directory, or <code>NULL</code> (the
default) to search for one from the current working
directory. This function <strong>does</strong> require that the directory is
configured for orderly, and not just outpack (see
<a href="orderly_init.html">orderly_init</a> for details).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An (currently unstable) object of class
<code>orderly_cleanup_status</code> within which the element <code>delete</code>
indicates files that would be deleted (for
<code>orderly_cleanup_status</code>) or that were deleted (for
<code>orderly_cleanup</code>)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>After file deletion, we look through and remove all empty
directories; orderly2 has similar semantics here to git where
directories are never directly tracked.</p>
<p>For recent <code>gert</code> we will ask git if files are ignored; if ignored
then they are good candidates for deletion! We encourage you to
keep a per-report <code>.gitignore</code> that lists files that will copy
into the source directory, and then we can use that same
information to clean up these files after generation.
Importantly, even if a file matches an ignore rule but has been
committed to your repository, it will no longer match the ignore
rule.</p>
    </div>
    <div class="section level2">
    <h2 id="notes-for-user-of-orderly-">Notes for user of orderly1<a class="anchor" aria-label="anchor" href="#notes-for-user-of-orderly-"></a></h2>



<p>In orderly1 this function has quite different semantics, because
the full set of possible files is always knowable from the yaml
file. So there, we start from the point of view of the list of
files then compare that with the directory.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a simple example:</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/Rtmp6Hh44x/orderly2_ex_1d3e230f3505'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We simulate running a packet interactively by using 'source';</span></span></span>
<span class="r-in"><span><span class="co"># you might have run this line-by-line, or with the "Source"</span></span></span>
<span class="r-in"><span><span class="co"># button in Rstudio.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"src/data/data.R"</span><span class="op">)</span>, chdir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Having run this, the output of the report is present in the</span></span></span>
<span class="r-in"><span><span class="co"># source directory:</span></span></span>
<span class="r-in"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB; font-weight: bold;">/tmp/Rtmp6Hh44x/orderly2_ex_1d3e230f3505</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── orderly_config.yml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ├── <span style="color: #0000BB; font-weight: bold;">shared</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> │   └── <span style="color: #00BB00;">palette.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> └── <span style="color: #0000BB; font-weight: bold;">src</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   ├── <span style="color: #00BB00;">data.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── data.rds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">depends</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">depends.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">parameters</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">parameters.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">run_info</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">run_info.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ├── <span style="color: #0000BB; font-weight: bold;">shared</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     │   └── <span style="color: #00BB00;">shared.R</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     └── <span style="color: #0000BB; font-weight: bold;">strict</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         └── <span style="color: #00BB00;">strict.R</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can detect what might want cleaning up by running</span></span></span>
<span class="r-in"><span><span class="co"># "orderly_cleanup_status":</span></span></span>
<span class="r-in"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu">orderly_cleanup_status</span><span class="op">(</span><span class="st">"data"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">data</span> is not clean:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 1 file can be deleted by running 'orderly2::orderly_cleanup("data")':</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • data.rds</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Soon this will print more nicely to the screen, but for now you</span></span></span>
<span class="r-in"><span><span class="co"># can see that the status of "data.rds" is "derived", which means</span></span></span>
<span class="r-in"><span><span class="co"># that orderly knows that it is subject to being cleaned up; the</span></span></span>
<span class="r-in"><span><span class="co"># "delete" element shows what will be deleted.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Do the actual deletion:</span></span></span>
<span class="r-in"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu">orderly_cleanup</span><span class="op">(</span><span class="st">"data"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Deleting 1 file from 'data':</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • data.rds</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

