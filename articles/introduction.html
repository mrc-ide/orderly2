<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to orderly2 • orderly2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to orderly2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to orderly2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<p>This vignette provides a how-to style introduction to
<code>orderly2</code>, an overview of key ingredients to writing orderly
reports, and a summary of key features and ideas. It may be useful to
look at <code><a href="../articles/orderly2.html">vignette("orderly2")</a></code> for a more roundabout
discussion of what <code>orderly2</code> is trying to achieve, or
<code><a href="../articles/migrating.html">vignette("migrating")</a></code> if you are familiar with version 1 of
orderly as this explains concepts in terms of differences from the
previous version.</p>
<p>You might also prefer the <a href="https://mrc-ide.github.io/orderly-tutorial" class="external-link">orderly tutorial</a>
which works through similar material in slide form, or <a href="https://www.youtube.com/watch?v=lkPgihFQbrk" class="external-link">watch a short
talk</a> that describes the ideas in the package, and why it differs to
other approaches to reproducibility and workflows.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span></span>
<span>  <span class="st">"orderly2"</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://mrc-ide.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-an-empty-orderly-repository">Creating an empty orderly repository<a class="anchor" aria-label="anchor" href="#creating-an-empty-orderly-repository"></a>
</h2>
<p>The first step is to initialise an empty <code>orderly2</code>
repository. An <code>orderly2</code> repository is a directory with the
file <code>orderly_config.yml</code> within it, and since version 2 also
a directory <code>.outpack/</code>. Files within the
<code>.outpack/</code> directory should never be directly modified by
users and this directory should be excluded from version control (see
<code><a href="../reference/orderly_gitignore_update.html">orderly2::orderly_gitignore_update</a></code>).</p>
<p>Create an orderly2 repository by calling
<code><a href="../reference/orderly_init.html">orderly2::orderly_init()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># we'll use a temporary directory here - see note below</span></span>
<span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_init.html">orderly_init</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/Rtmp0CQ120/file216d1d3a32e8'</span></span></code></pre></div>
<p>which creates a few files:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">.</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">.outpack</span></span></span>
<span><span class="co">## │   ├── config.json</span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">location</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">metadata</span></span></span>
<span><span class="co">## └── orderly_config.yml</span></span></code></pre>
<p>This step should be performed on a completely empty directory,
otherwise an error will be thrown. Later, you will re-initialise an
<code>orderly2</code> repository when cloning to a new machine, such as
when working with others; this is discussed in
<code><a href="../articles/collaboration.html">vignette("collaboration")</a></code>.</p>
<p>The <code>orderly_config.yml</code> file contains very little by
default:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">minimum_orderly_version</span><span class="kw">:</span><span class="at"> </span><span class="st">"1.99.0"</span></span></code></pre></div>
<p>For this vignette, the created orderly root is in R’s per-session
temporary directory, which will be deleted once R exits. If you want to
use a directory that will persist across restarting R (which you would
certainly want when using <code>orderly2</code> on a real project!) you
should replace this with a path within your home directory, or other
location that you control.</p>
<!-- Some sleight-of-hand is required here, as knitr/rmarkdown do not
    allow `setwd` calls to have an effect that persists across
    chunks. We'll tell the user that we've done this, and make sure
    that in future chunks the working directory is set correctly. -->
<p>For the rest of the vignette we will evaluate commands from within
this directory, by changing the directory to the path we’ve created:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-your-first-orderly-report">Creating your first orderly report<a class="anchor" aria-label="anchor" href="#creating-your-first-orderly-report"></a>
</h2>
<p>An orderly report is a directory <code>src/&lt;name&gt;</code>
containing an orderly file <code>&lt;name&gt;.R</code>. That file may
have special commands in it, but for now we’ll create one that is as
simple as possible; we’ll create some random data and save it to disk.
This seems silly, but imagine this standing in for something like:</p>
<ul>
<li>downloading file from some external site or resource</li>
<li>running a simulation and saving output</li>
<li>fitting a model to data</li>
<li>merging some set of files together to create a final data set</li>
</ul>
<p>Our directory structure (ignoring <code>.outpack</code>) looks
like:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">.</span></span></span>
<span><span class="co">## ├── orderly_config.yml</span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">src</span></span></span>
<span><span class="co">##     └── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">##         ├── data.csv</span></span>
<span><span class="co">##         └── <span style="color: #00BB00;">incoming_data.R</span></span></span></code></pre>
<p>and <code>src/incoming_data/incoming_data.R</code> contains:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"data.rds"</span><span class="op">)</span></span></code></pre></div>
<p>To run the report and create a new <strong>packet</strong>, use
<code><a href="../reference/orderly_run.html">orderly2::orderly_run()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"incoming_data"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">incoming_data</span>' `20250901-150705-4ee9d3d9` at 2025-09-01 15:07:05.314869</span></span>
<span><span class="co">## &gt; d &lt;- read.csv("data.csv")</span></span>
<span><span class="co">## &gt; d$z &lt;- resid(lm(y ~ x, d))</span></span>
<span><span class="co">## &gt; saveRDS(d, "data.rds")</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">incoming_data.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150705-4ee9d3d9 at 2025-09-01 15:07:05.379051 (0.06418157 secs)</span></span>
<span><span class="va">id</span></span>
<span><span class="co">## [1] "20250901-150705-4ee9d3d9"</span></span></code></pre></div>
<p>The <code>id</code> that is created is a new identifier for the
packet that will be both unique among all packets (within reason) and
chronologically sortable. A packet that has an id that sorts after
another packet’s id was started before that packet.</p>
<p>Having run the report, our directory structure looks like:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">.</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">archive</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">## │       └── <span style="color: #0000BB; font-weight: bold;">20250901-150705-4ee9d3d9</span></span></span>
<span><span class="co">## │           ├── data.csv</span></span>
<span><span class="co">## │           ├── data.rds</span></span>
<span><span class="co">## │           └── <span style="color: #00BB00;">incoming_data.R</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">draft</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">## ├── orderly_config.yml</span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">src</span></span></span>
<span><span class="co">##     └── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">##         ├── data.csv</span></span>
<span><span class="co">##         └── <span style="color: #00BB00;">incoming_data.R</span></span></span></code></pre>
<p>A few things have changed here:</p>
<ul>
<li>we have a directory archive/incoming_data/20250901-150705-4ee9d3d9;
this directory contains
<ul>
<li>the file that was created when we ran the report
(<code>data.rds</code>; see the script above)</li>
<li>a log of what happened when the report was run and the packet was
created</li>
<li>
<code>incoming_data.R</code> and <code>data.csv</code>, the original
input that have come from our source tree</li>
</ul>
</li>
<li>there is an empty directory <code>draft/incoming_data</code> which
was created when orderly ran the report in the first place</li>
</ul>
<p>In addition, quite a few files have changed within the
<code>.outpack</code> directory, but these are not covered here.</p>
<p>That’s it! Notice that the initial script is just a plain R script,
and you can develop it interactively from within the
<code>src/incoming_data</code> directory. Note however, that any paths
referred to within will be relative to <code>src/incoming_data</code>
and <strong>not</strong> the orderly repository root. This is important
as all reports only see the world relative to their
<code>incoming_data.R</code> file.</p>
<p>Once created, you can then refer to this report by id and pull its
files wherever you need them, both in the context of another orderly
report or just to copy to your desktop to email someone. For example, to
copy the file <code>data.rds</code> that we created to some location
outside of orderly’s control you could do</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span></span>
<span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_copy_files.html">orderly_copy_files</a></span><span class="op">(</span><span class="va">id</span>, files <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"final.rds"</span> <span class="op">=</span> <span class="st">"data.rds"</span><span class="op">)</span>,</span>
<span>                             dest <span class="op">=</span> <span class="va">dest</span><span class="op">)</span></span></code></pre></div>
<p>which copies <code>data.rds</code> to some new temporary directory
<code>dest</code> with name <code>final.rds</code>. This uses
<code>orderly2</code>’s <code>outpack_</code> functions, which are
designed to interact with outpack archives regardless of how they were
created (<code>orderly2</code> is a program that creates
<code>outpack</code> archives). Typically these are lower-level than
<code>orderly_</code> functions.</p>
</div>
<div class="section level2">
<h2 id="depending-on-packets-from-another-report">Depending on packets from another report<a class="anchor" aria-label="anchor" href="#depending-on-packets-from-another-report"></a>
</h2>
<p>Creating a new dataset is mostly useful if someone else can use it.
To do this we introduce the first of the special orderly commands that
you can use from an orderly file</p>
<p>The <code>src/</code> directory now looks like:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">src</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">analysis</span></span></span>
<span><span class="co">## │   └── <span style="color: #00BB00;">analysis.R</span></span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">##     ├── data.csv</span></span>
<span><span class="co">##     └── <span style="color: #00BB00;">incoming_data.R</span></span></span></code></pre>
<p>and <code>src/analysis/analysis.R</code> contains:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_dependency.html">orderly_dependency</a></span><span class="op">(</span><span class="st">"incoming_data"</span>, <span class="st">"latest()"</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"incoming.rds"</span> <span class="op">=</span> <span class="st">"data.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"incoming.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"analysis.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here, we’ve used <code><a href="../reference/orderly_dependency.html">orderly2::orderly_dependency()</a></code> to pull
in the file <code>data.rds</code> from the most recent version
(<code>latest()</code>) of the <code>data</code> packet with the
filename <code>incoming.rds</code>, then we’ve used that file as normal
to make a plot, which we’ve saved as <code>analysis.png</code>.</p>
<p>We can run this just as before, using
<code><a href="../reference/orderly_run.html">orderly2::orderly_run()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">analysis</span>' `20250901-150705-d3a26aff` at 2025-09-01 15:07:05.831262</span></span>
<span><span class="co">## &gt; orderly2::orderly_dependency("incoming_data", "latest()",</span></span>
<span><span class="co">## +                              c("incoming.rds" = "data.rds"))</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Depending on <span style="color: #0000BB;">incoming_data</span> @ `20250901-150705-4ee9d3d9` (via latest(name == "incoming_data"))</span></span>
<span><span class="co">## &gt; d &lt;- readRDS("incoming.rds")</span></span>
<span><span class="co">## &gt; png("analysis.png")</span></span>
<span><span class="co">## &gt; plot(y ~ x, d)</span></span>
<span><span class="co">## &gt; dev.off()</span></span>
<span><span class="co">## agg_png </span></span>
<span><span class="co">##       2</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">analysis.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150705-d3a26aff at 2025-09-01 15:07:05.921172 (0.08991027 secs)</span></span></code></pre></div>
<p>For more information on dependencies, see
<code><a href="../articles/dependencies.html">vignette("dependencies")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="available-in-report-orderly-commands">Available in-report orderly commands<a class="anchor" aria-label="anchor" href="#available-in-report-orderly-commands"></a>
</h2>
<p>The function <code><a href="../reference/orderly_dependency.html">orderly2::orderly_dependency()</a></code> is designed
to operate while the packet runs. These functions all act by adding
metadata to the final packet, and perhaps by copying files into the
directory.</p>
<ul>
<li>
<code><a href="../reference/orderly_description.html">orderly2::orderly_description()</a></code>: Provide a longer name
and description for your report; this can be reflected in tooling that
uses orderly metadata to be much more informative than your short
name.</li>
<li>
<code><a href="../reference/orderly_parameters.html">orderly2::orderly_parameters()</a></code>: Declares parameters
that can be passed in to control the behaviour of the report, returning
a list of the parameters. Parameters are key-value pairs of simple data
(booleans, numbers, strings) which your report can respond to. They can
also be used in queries to <code><a href="../reference/orderly_dependency.html">orderly2::orderly_dependency()</a></code>
to find packets that satisfy some criteria.</li>
<li>
<code><a href="../reference/orderly_resource.html">orderly2::orderly_resource()</a></code>: Declares that a file is a
<em>resource</em>; a file that is an input to the the report, and which
comes from this source directory. By default, orderly treats all files
in the directory as a resource, but it can be useful to mark these
explicitly, and necessary to do so in “strict mode” (see below). Files
that have been marked as a resource are <strong>immutable</strong> and
may not be deleted or modified.</li>
<li>
<code><a href="../reference/orderly_shared_resource.html">orderly2::orderly_shared_resource()</a></code>: Copies a file from
the “shared resources” directory <code>shared/</code>, which can be data
files or source code located at the root of the orderly repository. This
can be a reasonable way of sharing data or commonly used code among
several reports.</li>
<li>
<code><a href="../reference/orderly_artefact.html">orderly2::orderly_artefact()</a></code>: Declares that a file (or
set of files) will be created by this report, before it is even run.
Doing this makes it easier to check that the report behaves as expected
and can allow reasoning about what a related set of reports will do
without running them. By declaring something as an artefact (especially
in conjunction with “strict mode”) it is also easier to clean up
<code>src</code> directories that have been used in interactive
development (see below).</li>
<li>
<code><a href="../reference/orderly_dependency.html">orderly2::orderly_dependency()</a></code>: Copy files from one
packet into this packet as it runs, as seen above.</li>
<li>
<code><a href="../reference/orderly_strict_mode.html">orderly2::orderly_strict_mode()</a></code>: Declares that this
report will be run in “strict mode” (see below).</li>
</ul>
<p>In addition, there is also a function
<code>orderly::orderly_run_info()</code> that can be used while running
a report that returns information about the currently running report
(its id, resolved dependencies etc).</p>
<p>Let’s add some additional annotations to the previous reports:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_strict_mode.html">orderly_strict_mode</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_resource.html">orderly_resource</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_artefact.html">orderly_artefact</a></span><span class="op">(</span>description <span class="op">=</span> <span class="st">"Processed data"</span>, <span class="st">"data.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"data.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Here, we’ve added a block of special orderly commands; these could go
anywhere, for example above the files that they refer to. If strict mode
is enabled (see below) then <code><a href="../reference/orderly_resource.html">orderly2::orderly_resource</a></code>
calls must go before the files are used as they will only be made
available at that point (see below).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"incoming_data"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">incoming_data</span>' `20250901-150706-218db206` at 2025-09-01 15:07:06.134949</span></span>
<span><span class="co">## &gt; orderly2::orderly_strict_mode()</span></span>
<span><span class="co">## &gt; orderly2::orderly_resource("data.csv")</span></span>
<span><span class="co">## &gt; orderly2::orderly_artefact(description = "Processed data", "data.rds")</span></span>
<span><span class="co">## &gt; d &lt;- read.csv("data.csv")</span></span>
<span><span class="co">## &gt; d$z &lt;- resid(lm(y ~ x, d))</span></span>
<span><span class="co">## &gt; saveRDS(d, "data.rds")</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">incoming_data.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150706-218db206 at 2025-09-01 15:07:06.163918 (0.02896881 secs)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameterised-reports">Parameterised reports<a class="anchor" aria-label="anchor" href="#parameterised-reports"></a>
</h2>
<p>Much of the flexibility that comes from the orderly graph comes from
using parameterised reports; these are reports that take a set of
parameters and then change behaviour based on these parameters.
Downstream reports can depend on a parameterised report and filter based
on suitable parameters.</p>
<p>For example, consider a simple report where we generate samples based
on some parameter:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_parameters.html">orderly_parameters</a></span><span class="op">(</span>n_samples <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_samples</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_samples</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"data.rds"</span><span class="op">)</span></span></code></pre></div>
<p>This creates a report that has a single parameter
<code>n_samples</code> with a default value of 10. We could have
used</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_parameters.html">orderly_parameters</a></span><span class="op">(</span>n_samples <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>to define a parameter with no default, or defined multiple parameters
with</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_parameters.html">orderly_parameters</a></span><span class="op">(</span>n_samples <span class="op">=</span> <span class="fl">10</span>, distribution <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span></code></pre></div>
<p>You can do anything in your report that switches on the value of a
parameter:</p>
<ul>
<li>You might read different URLs to fetch different underlying
data</li>
<li>You might fit a different analysis</li>
<li>You might read different shared resources (see below)</li>
<li>You might depend on different dependencies</li>
<li>You might produce different artefacts</li>
</ul>
<p>However, you should see parameters as relatively heavyweight things
and try to have a consistent set over all packets created from a report.
In this report we use it to control the size of the generated data
set.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_samples <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">random</span>' `20250901-150706-6096d34f` at 2025-09-01 15:07:06.381855</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Parameters:</span></span>
<span><span class="co">## • n_samples: 15</span></span>
<span><span class="co">## &gt; pars &lt;- orderly2::orderly_parameters(n_samples = 10)</span></span>
<span><span class="co">## &gt; x &lt;- seq_len(pars$n_samples)</span></span>
<span><span class="co">## &gt; d &lt;- data.frame(x = x, y = x + rnorm(pars$n_samples))</span></span>
<span><span class="co">## &gt; saveRDS(d, "data.rds")</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">random.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150706-6096d34f at 2025-09-01 15:07:06.412573 (0.03071809 secs)</span></span></code></pre></div>
<p>Our resulting file has 15 rows, as the parameter we passed in
affected the report:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_copy_files.html">orderly_copy_files</a></span><span class="op">(</span><span class="va">id</span>, files <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random.rds"</span> <span class="op">=</span> <span class="st">"data.rds"</span><span class="op">)</span>,</span>
<span>                             dest <span class="op">=</span> <span class="va">dest</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dest</span>, <span class="st">"random.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##     x          y</span></span>
<span><span class="co">## 1   1  0.4463006</span></span>
<span><span class="co">## 2   2  2.6289820</span></span>
<span><span class="co">## 3   3  5.0650249</span></span>
<span><span class="co">## 4   4  2.3690106</span></span>
<span><span class="co">## 5   5  5.5124269</span></span>
<span><span class="co">## 6   6  4.1369885</span></span>
<span><span class="co">## 7   7  6.4779875</span></span>
<span><span class="co">## 8   8  7.9473981</span></span>
<span><span class="co">## 9   9  9.5429963</span></span>
<span><span class="co">## 10 10  9.0859252</span></span>
<span><span class="co">## 11 11 11.4681544</span></span>
<span><span class="co">## 12 12 12.3629513</span></span>
<span><span class="co">## 13 13 11.6954565</span></span>
<span><span class="co">## 14 14 14.7377763</span></span>
<span><span class="co">## 15 15 16.8885049</span></span></code></pre></div>
<p>You can use these parameters in orderly’s search functions. For
example we can find the most recent version of a packet by running:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_search.html">orderly_search</a></span><span class="op">(</span><span class="st">'latest(name == "random")'</span><span class="op">)</span></span>
<span><span class="co">## [1] "20250901-150706-6096d34f"</span></span></code></pre></div>
<p>But we can also pass in parameter queries here:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_search.html">orderly_search</a></span><span class="op">(</span><span class="st">'latest(name == "random" &amp;&amp; parameter:n_samples &gt; 10)'</span><span class="op">)</span></span>
<span><span class="co">## [1] "20250901-150706-6096d34f"</span></span></code></pre></div>
<p>These can be used within <code><a href="../reference/orderly_dependency.html">orderly2::orderly_dependency()</a></code>
(the <code>name == "random"</code> part is implied by the first
<code>name</code> argument), for example</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_dependency.html">orderly_dependency</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"latest(parameter:n_samples &gt; 10)"</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"randm.rds"</span> <span class="op">=</span> <span class="st">"data.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In this case if the report that you are querying <em>from</em> also
has parameters you can use these within the query, using the
<code>this</code> prefix. So suppose our downstream report simply uses
<code>n</code> for the number of samples we might write:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_dependency.html">orderly_dependency</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"latest(parameter:n_samples == this:n)"</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"randm.rds"</span> <span class="op">=</span> <span class="st">"data.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>to depend on the most recent packet called <code>random</code> where
it has a parameter <code>n_samples</code> which has the same value as
the current report’s parameter <code>n</code>.</p>
<p>See the outpack query documentation for much more detail on this.</p>
</div>
<div class="section level2">
<h2 id="shared-resources">Shared resources<a class="anchor" aria-label="anchor" href="#shared-resources"></a>
</h2>
<p>Sometimes it is useful to share data between different reports, for
example some common source utilities that don’t warrant their own
package, or some common data.</p>
<p>To do this, create a directory <code>shared</code> at the orderly
root and put in it any files or directories you might want to share.</p>
<p>Suppose our shared directory contains a file
<code>data.csv</code>:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">.</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">archive</span></span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">analysis</span></span></span>
<span><span class="co">## │   │   └── <span style="color: #0000BB; font-weight: bold;">20250901-150705-d3a26aff</span></span></span>
<span><span class="co">## │   │       ├── <span style="color: #00BB00;">analysis.R</span></span></span>
<span><span class="co">## │   │       ├── <span style="color: #BB00BB; font-weight: bold;">analysis.png</span></span></span>
<span><span class="co">## │   │       └── incoming.rds</span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">20250901-150705-4ee9d3d9</span></span></span>
<span><span class="co">## │   │   │   ├── data.csv</span></span>
<span><span class="co">## │   │   │   ├── data.rds</span></span>
<span><span class="co">## │   │   │   └── <span style="color: #00BB00;">incoming_data.R</span></span></span>
<span><span class="co">## │   │   └── <span style="color: #0000BB; font-weight: bold;">20250901-150706-218db206</span></span></span>
<span><span class="co">## │   │       ├── data.csv</span></span>
<span><span class="co">## │   │       ├── data.rds</span></span>
<span><span class="co">## │   │       └── <span style="color: #00BB00;">incoming_data.R</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">random</span></span></span>
<span><span class="co">## │       └── <span style="color: #0000BB; font-weight: bold;">20250901-150706-6096d34f</span></span></span>
<span><span class="co">## │           ├── data.rds</span></span>
<span><span class="co">## │           └── <span style="color: #00BB00;">random.R</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">draft</span></span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">analysis</span></span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">random</span></span></span>
<span><span class="co">## ├── orderly_config.yml</span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">shared</span></span></span>
<span><span class="co">## │   └── data.csv</span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">src</span></span></span>
<span><span class="co">##     ├── <span style="color: #0000BB; font-weight: bold;">analysis</span></span></span>
<span><span class="co">##     │   └── <span style="color: #00BB00;">analysis.R</span></span></span>
<span><span class="co">##     ├── <span style="color: #0000BB; font-weight: bold;">incoming_data</span></span></span>
<span><span class="co">##     │   ├── data.csv</span></span>
<span><span class="co">##     │   └── <span style="color: #00BB00;">incoming_data.R</span></span></span>
<span><span class="co">##     └── <span style="color: #0000BB; font-weight: bold;">random</span></span></span>
<span><span class="co">##         └── <span style="color: #00BB00;">random.R</span></span></span></code></pre>
<p>We can then write an orderly report <code>use_shared</code> that uses
this shared file, with its <code>use_shared.R</code> containing:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_shared_resource.html">orderly_shared_resource</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_artefact.html">orderly_artefact</a></span><span class="op">(</span>description <span class="op">=</span> <span class="st">"analysis"</span>, <span class="st">"analysis.png"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"analysis.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can run this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"use_shared"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">use_shared</span>' `20250901-150706-e0820744` at 2025-09-01 15:07:06.881635</span></span>
<span><span class="co">## &gt; orderly2::orderly_shared_resource("data.csv")</span></span>
<span><span class="co">## &gt; orderly2::orderly_artefact(description = "analysis", "analysis.png")</span></span>
<span><span class="co">## &gt; d &lt;- read.csv("data.csv")</span></span>
<span><span class="co">## &gt; png("analysis.png")</span></span>
<span><span class="co">## &gt; plot(y ~ x, d)</span></span>
<span><span class="co">## &gt; dev.off()</span></span>
<span><span class="co">## agg_png </span></span>
<span><span class="co">##       2</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">use_shared.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150706-e0820744 at 2025-09-01 15:07:06.922733 (0.04109764 secs)</span></span></code></pre></div>
<p>In the resulting archive, the file that was used from the shared
directory is present:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">archive/use_shared</span></span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">20250901-150706-e0820744</span></span></span>
<span><span class="co">##     ├── <span style="color: #BB00BB; font-weight: bold;">analysis.png</span></span></span>
<span><span class="co">##     ├── data.csv</span></span>
<span><span class="co">##     └── <span style="color: #00BB00;">use_shared.R</span></span></span></code></pre>
<p>This is a general property of orderly: it tries to save all the
inputs alongside the final results of the analysis, so that later on you
can check to see what went into an analysis and what might have changed
between versions.</p>
</div>
<div class="section level2">
<h2 id="strict-mode">Strict mode<a class="anchor" aria-label="anchor" href="#strict-mode"></a>
</h2>
<p>The previous version of orderly (<code>orderly1</code>; see
<code><a href="../articles/migrating.html">vignette("migrating")</a></code>) was very fussy about all input being
strictly declared before a report could be run, so that it was clear
what was really required in order to run something. From version 2 this
is relaxed by default, but you can opt into most of the old behaviours
and checks by adding</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_strict_mode.html">orderly_strict_mode</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>anywhere within your orderly file (conventionally at the top). We may
make this more granular in future, but by adding this we:</p>
<ul>
<li>only copy files from the source directory
(<code>src/&lt;reportname&gt;/</code>) to the draft directory where the
report runs (<code>draft/&lt;reportname&gt;/&lt;packet-id&gt;</code>)
that were declared with <code><a href="../reference/orderly_resource.html">orderly2::orderly_resource</a></code>; this
leaves behind any extra files left over in development</li>
<li>warn at the end of running a packet if any files are found that are
not part of an artefact</li>
</ul>
<p>Using strict mode also helps <code>orderly2</code> clean up the
<code>src/&lt;reportname&gt;</code> directory more effectively after
interactive development (see next section).</p>
</div>
<div class="section level2">
<h2 id="interactive-development">Interactive development<a class="anchor" aria-label="anchor" href="#interactive-development"></a>
</h2>
<p>Set your working directory to <code>src/&lt;reportname&gt;</code> and
any orderly script should be fully executable (e.g., source with
Rstudio’s <code>Source</code> button, or R’s <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>
function). Dependencies will be copied over as needed.</p>
<p>After doing this, you will have a mix of files within your source
directory. We recommend a per-source-directory <code>.gitignore</code>
which will keep these files out of version control (see below). We will
soon implement support for cleaning up generated files from this
directory.</p>
<p>For example, suppose that we have interactively run our
<code>incoming_data/incoming_data.R</code> script, we would leave behind
generated files. We can report on this with
<code><a href="../reference/orderly_cleanup.html">orderly2::orderly_cleanup_status</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_cleanup.html">orderly_cleanup_status</a></span><span class="op">(</span><span class="st">"incoming_data"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">incoming_data</span> is not clean:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> 1 file can be deleted by running 'orderly2::orderly_cleanup("incoming_data")':</span></span>
<span><span class="co">##   • data.rds</span></span></code></pre></div>
<p>If you have files here that are unknown to orderly it will tell you
about them and prompt you to tell it about them explicitly.</p>
<p>You can clean up generated files by running (as suggested in the
message):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_cleanup.html">orderly_cleanup</a></span><span class="op">(</span><span class="st">"incoming_data"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Deleting 1 file from 'incoming_data':</span></span>
<span><span class="co">## • data.rds</span></span></code></pre></div>
<p>There is a <code>dry_run = TRUE</code> argument you can pass if you
want to see what would be deleted without using the status function.</p>
<p>You can also keep these files out of git by using the
<code><a href="../reference/orderly_gitignore_update.html">orderly2::orderly_gitignore_update</a></code> function:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_gitignore_update.html">orderly_gitignore_update</a></span><span class="op">(</span><span class="st">"incoming_data"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Wrote 'src/incoming_data/.gitignore'</span></span></code></pre></div>
<p>This creates (or updates) a <code>.gitignore</code> file within the
report so that generated files will not be included by git. If you have
already accidentally committed them then the gitignore has no real
effect and you should do some git surgery, see the git manuals or this
<a href="https://ohshitgit.com/" class="external-link">handy, if profane, guide</a>.</p>
</div>
<div class="section level2">
<h2 id="deleting-things-from-the-archive">Deleting things from the archive<a class="anchor" aria-label="anchor" href="#deleting-things-from-the-archive"></a>
</h2>
<p>If you delete packets from your <code>archive/</code> directory then
this puts <code>orderly2</code> into an inconsistent state with its
metadata store. Sometimes this does not matter (e.g., if you delete old
copies that would never be candidates for inclusion with
<code><a href="../reference/orderly_dependency.html">orderly2::orderly_dependency</a></code> you will never notice).
However, if you delete the most recent copy of a packet and then try and
depend on it, you will get an error.</p>
<p>At the moment, we have two copies of the <code>incoming_data</code>
task:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_metadata_extract.html">orderly_metadata_extract</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"incoming_data"</span>,</span>
<span>  extract <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>time <span class="op">=</span> <span class="st">"time.start"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##                         id                time</span></span>
<span><span class="co">## 1 20250901-150705-4ee9d3d9 2025-09-01 15:07:05</span></span>
<span><span class="co">## 2 20250901-150706-218db206 2025-09-01 15:07:06</span></span></code></pre></div>
<p>When we run the <code>analysis</code> task, it will pull in the most
recent version (<code>20250901-150706-218db206</code>). However, if you
had deleted this manually (e.g., to save space or accidentally) or
corrupted it (e.g., by opening some output in Excel and letting it save
changes) it will not be able to be included, and running
<code>analysis</code> will fail:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">analysis</span>' `20250901-150707-7fc26a62` at 2025-09-01 15:07:07.50359</span></span>
<span><span class="co">## &gt; orderly2::orderly_dependency("incoming_data", "latest()",</span></span>
<span><span class="co">## +                              c("incoming.rds" = "data.rds"))</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> Error running <span style="color: #0000BB;">analysis.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150707-7fc26a62 at 2025-09-01 15:07:07.584069 (0.08047891 secs)</span></span>
<span><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `orderly2::orderly_run()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> Failed to run report</span></span>
<span><span class="co">## <span style="font-weight: bold;">Caused by error in `orderly_copy_files()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> Unable to copy files, due to deleted packet 20250901-150706-218db206</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider 'orderly2::orderly_validate_archive("20250901-150706-218db206",</span></span>
<span><span class="co">##   action = "orphan")' to remove this packet from consideration</span></span>
<span><span class="co">## <span style="font-weight: bold;">Caused by error:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> File not found in archive</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> data.rds</span></span></code></pre></div>
<p>The error here tries to be fairly informative, telling us that we
failed because when copying files from
<code>20250901-150706-218db206</code> we found that the packet was
corrupt, because the file <code>data.rds</code> was not found in the
archive. It also suggests a fix; we can tell <code>orderly2</code> that
<code>20250901-150706-218db206</code> is “orphaned” and should not be
considered for inclusion when we look for dependencies.</p>
<p>We can carry out the suggestion and just validate this packet by
running</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_validate_archive.html">orderly_validate_archive</a></span><span class="op">(</span><span class="st">"20250901-150706-218db206"</span>, action <span class="op">=</span> <span class="st">"orphan"</span><span class="op">)</span></span></code></pre></div>
<p>or we can validate <em>all</em> the packets we have:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_validate_archive.html">orderly_validate_archive</a></span><span class="op">(</span>action <span class="op">=</span> <span class="st">"orphan"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> 20250901-150705-4ee9d3d9 (incoming_data) is valid</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> 20250901-150705-d3a26aff (analysis) is valid</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> 20250901-150706-218db206 (incoming_data) is invalid due to its files</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> 20250901-150706-6096d34f (random) is valid</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> 20250901-150706-e0820744 (use_shared) is valid</span></span></code></pre></div>
<p>If we had the option <code>core.require_complete_tree</code> enabled,
then this process would also look for any packets that used our
now-deleted packet and orphan those too, as we no longer have a complete
tree that includes them.</p>
<p>If you want to remove references to the orphaned packets, you can use
<code><a href="../reference/orderly_prune_orphans.html">orderly2::orderly_prune_orphans()</a></code> to remove them
entirely:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_prune_orphans.html">orderly_prune_orphans</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Pruning 1 orphan packet</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="debugging-and-coping-with-errors">Debugging and coping with errors<a class="anchor" aria-label="anchor" href="#debugging-and-coping-with-errors"></a>
</h2>
<p>(To be written)</p>
</div>
<div class="section level2">
<h2 id="interaction-with-version-control">Interaction with version control<a class="anchor" aria-label="anchor" href="#interaction-with-version-control"></a>
</h2>
<p>Some guidelines:</p>
<p>Make sure to exclude some files from <code>git</code> by listing them
in <code>.gitignore</code>:</p>
<ul>
<li>
<code>.outpack/</code> - nothing in here is suitable for version
control</li>
<li>
<code>archive/</code> - if you have <code>core.archive_path</code>
set to a non-null value, this should be excluded. The default is
<code>archive</code>
</li>
<li>
<code>draft/</code> - the temporary draft directory</li>
<li>
<code>orderly_envir.yml</code> - used for setting machine-specific
configuration</li>
</ul>
<p>You absolutely should version control some files:</p>
<ul>
<li>
<code>src/</code> the main source of your analyses</li>
<li>
<code>orderly_config.yml</code> - this high level configuration is
suitable for sharing</li>
<li>Any shared resource directory (configured in
<code>orderly_config.yml</code>) should probably be version
controlled</li>
</ul>
<p>Your source repository will end up in multiple people’s machines,
each of which are configured differently. The configuration option set
via <code><a href="../reference/orderly_config_set.html">orderly2::orderly_config_set</a></code> are designed to be
(potentially) different for different users, so this configuration needs
to be not version controlled. It also means that reports/packets can’t
directly refer to values set here. This includes the directory used to
save archive packets at (if enabled) and the names of locations
(equivalent to git remotes).</p>
<p>You may find it useful to include scripts that help users set up
common locations, but like with git, different users may use different
names for the same remote (e.g., one user may have a location called
<code>data</code> while for another it is called
<code>data-incoming</code>, depending on their perspective about the use
of the location).</p>
<p><code>orderly2</code> will always try and save information about the
current state of the git source repository alongside the packet
metadata. This includes the current branch, commit (sha) and remote url.
This is to try and create links between the final version of the packet
and the upstream source repository.</p>
</div>
<div class="section level2">
<h2 id="interaction-with-the-outpack-store">Interaction with the outpack store<a class="anchor" aria-label="anchor" href="#interaction-with-the-outpack-store"></a>
</h2>
<p>As alluded to above, the <code>.outpack</code> directory contains
lots of information about packets that have been run, but is typically
“out of bounds” for normal use. This is effectively the “database” of
information about packets that have been run. Understanding how this
directory is structured is not required for using orderly, but is
included here for the avoidance of mystery! See the outpack
documentation (<code>vignette("outpack")</code>) for more details about
the ideas here.</p>
<p>After all the work above, our directory structure looks like:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">.outpack</span></span></span>
<span><span class="co">## ├── config.json</span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">index</span></span></span>
<span><span class="co">## │   └── outpack.rds</span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">location</span></span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">local</span></span></span>
<span><span class="co">## │   │   ├── 20250901-150705-4ee9d3d9</span></span>
<span><span class="co">## │   │   ├── 20250901-150705-d3a26aff</span></span>
<span><span class="co">## │   │   ├── 20250901-150706-6096d34f</span></span>
<span><span class="co">## │   │   └── 20250901-150706-e0820744</span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">orphan</span></span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">metadata</span></span></span>
<span><span class="co">##     ├── 20250901-150705-4ee9d3d9</span></span>
<span><span class="co">##     ├── 20250901-150705-d3a26aff</span></span>
<span><span class="co">##     ├── 20250901-150706-6096d34f</span></span>
<span><span class="co">##     └── 20250901-150706-e0820744</span></span></code></pre>
<p>As can be perhaps inferred from the filenames, the files
<code>.outpack/metadata/&lt;packet-id&gt;</code> are the metadata for
each packet as it has been run. The files
<code>.outpack/location/&lt;location-id&gt;/&lt;packet-id&gt;</code>
holds information about when the packet was first known about by a
location (here the location is the special “local” location).</p>
<p>The default orderly configuration is to store the final files in a
directory called <code>archive/</code>, but alternatively (or
additionally) you can use a <a href="https://en.wikipedia.org/wiki/Content-addressable_storage" class="external-link">content-
addressable</a> file store. With this enabled, the <code>.outpack</code>
directory looks like:</p>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">.outpack</span></span></span>
<span><span class="co">## ├── config.json</span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">files</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">sha256</span></span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">25</span></span></span>
<span><span class="co">## │       │   └── a728e372a5f3c522fd3d95857bc3ee2148ac8515f92e36544bc7182eb04f29</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">43</span></span></span>
<span><span class="co">## │       │   └── 9e8f3e1e45536acfc04bf3b8b6aff87923cc450e63937b1eab047d482a03a6</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">5f</span></span></span>
<span><span class="co">## │       │   └── 96f49230c2791c05706f24cb2335cd0fad5d3625dc6bca124c44a51857f3f8</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">93</span></span></span>
<span><span class="co">## │       │   └── fff560abd66944315e8cfc55b08a2ae095f5a5fcda8002e9e9737fa015a846</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">99</span></span></span>
<span><span class="co">## │       │   └── 19777e97fc7ef771d5c365348db4120b6264ea963507c1dae15a2f4ef898fb</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">a6</span></span></span>
<span><span class="co">## │       │   └── 80ab7c65a52327a3d9c5499d114f513f18eabe7f63a98f9fc308c2b3744c82</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">ba</span></span></span>
<span><span class="co">## │       │   └── aa052008cfa7a30c9d83a4105f1dfb1b5632cde45373829e0bc63ef0d48f34</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">d5</span></span></span>
<span><span class="co">## │       │   └── 0f20991ac416a9577edf0d3b5695f81d8d5daf91d3fb5bd5882361187d5b59</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">d9</span></span></span>
<span><span class="co">## │       │   └── 1699ae410cbd811e1f028f8a732e5162b7df854eec08d921141f965851272d</span></span>
<span><span class="co">## │       └── <span style="color: #0000BB; font-weight: bold;">ec</span></span></span>
<span><span class="co">## │           └── b53285781a4d36c65168c80ee14f2af2c885423c6166b9425f40c3c6cd8297</span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">index</span></span></span>
<span><span class="co">## │   └── outpack.rds</span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">location</span></span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">local</span></span></span>
<span><span class="co">## │   │   ├── 20250901-150705-4ee9d3d9</span></span>
<span><span class="co">## │   │   ├── 20250901-150705-d3a26aff</span></span>
<span><span class="co">## │   │   ├── 20250901-150706-6096d34f</span></span>
<span><span class="co">## │   │   └── 20250901-150706-e0820744</span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">orphan</span></span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">metadata</span></span></span>
<span><span class="co">##     ├── 20250901-150705-4ee9d3d9</span></span>
<span><span class="co">##     ├── 20250901-150705-d3a26aff</span></span>
<span><span class="co">##     ├── 20250901-150706-6096d34f</span></span>
<span><span class="co">##     └── 20250901-150706-e0820744</span></span></code></pre>
<p>The files under <code>.outpack/files/</code> should never be modified
or deleted. This approach to storage naturally deduplicates the file
archive, so that a large file used in many places is only ever stored
once.</p>
</div>
<div class="section level2">
<h2 id="relationship-between-orderly-and-outpack">Relationship between <code>orderly</code> and
<code>outpack</code><a class="anchor" aria-label="anchor" href="#relationship-between-orderly-and-outpack"></a>
</h2>
<p>The <code>orderly2</code> package is built on a metadata and file
storage system called <code>outpack</code>; we will be implementing
support for working with these metadata archives in other languages (see
<a href="https://github.com/mrc-ide/outpack_server" class="external-link"><code>outpack_server</code></a>
for our server implementation in Rust and <a href="https://github.com/mrc-ide/outpack-py" class="external-link"><code>outpack-py</code></a>
in Python). The metadata is discussed in more detail in
<code><a href="../articles/metadata.html">vignette("metadata")</a></code> and we will document the general ideas
more fully at <a href="https://github.com/mrc-ide/outpack" class="external-link"><code>mrc-ide/outpack</code></a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
