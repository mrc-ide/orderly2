<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Collaborative analysis • orderly2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Collaborative analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Collaborative analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/vignettes/collaboration.Rmd" class="external-link"><code>vignettes/collaboration.Rmd</code></a></small>
      <div class="d-none name"><code>collaboration.Rmd</code></div>
    </div>

    
    
<!--
unfortunately, this will not actually style the pkgdown site, due to a bug in downlit https://github.com/r-lib/downlit/issues/149, waiting on https://github.com/r-lib/downlit/pull/160 to be merged.
  -->
<style type="text/css">
.sourceCode {
    position: relative;
}
.alice {
    /* border: 3px solid red; */
    /* background-color: lightpink; */
    /* font-weight: bold; */
    padding-right: 30px
}
div pre.alice:after {
    content:"Alice";
    position: absolute;
    right: 0px;
    top: 0px;
    font-size: 80%;
    font-weight: normal;
    font-family: sans-serif;
    padding: 0 5px;
    color: hotpink;
}
.bob {
    /* background-color: lightblue; */
    /* border: 3px solid blue; */
    /* font-weight: bold; */
    padding-right: 30px
}
div pre.bob:after {
    content:"Bob";
    position: absolute;
    right: 0px;
    top: 0px;
    font-size: 80%;
    font-weight: normal;
    font-family: sans-serif;
    padding: 0 5px;
    color: blue;
}
</style>
<p>One of the core purposes of <code>orderly2</code> is to allow
collaborative workflows. For this to work we need to be able to find
packets that were run by someone else, somewhere else, or to share
packets that we have run with others. To do that, <code>orderly2</code>
has the idea of “locations”.</p>
<p>Locations behave in a similar way to “remotes” in <code>git</code>,
and some of the terminology for interacting with them is similar
(notably we can <code>pull</code> from and perhaps <code>push</code> to
a location). However, we have used a different name because every
<code>orderly2</code> working directory has at least one location - the
<code>local</code> location - which is not remote at all. We also
imagine that almost everyone using <code>orderly2</code> will be using
<code>git</code> and as <code>git</code> remotes and
<code>orderly2</code> locations refer to totally different things this
slightly different terminology may help keep things clearer.</p>
<p>Packets that are distributed by locations might have been created by
<code>orderly2</code>, but may have been created by some other system
that implements the <code>outpack</code> spec (see
<code><a href="../articles/metadata.html">vignette("metadata")</a></code>). As a result, through this
documentation you will see reference to software or details to do with
<code>outpack</code> but if you only use <code>orderly2</code> then you
can read that as being synonymous with <code>orderly2</code>.</p>
<div class="section level2">
<h2 id="type-of-location">Type of location<a class="anchor" aria-label="anchor" href="#type-of-location"></a>
</h2>
<p><code>orderly2</code> supports two types of locations by default:</p>
<ul>
<li>
<code>path</code>: these are any <code>orderly2</code> working copy
that you can find on your filesystem. Note that this could be a copy
that other people can see (for example on a network share, or on a
cloud-synced file system such as Dropbox or OneDrive) see <a href="#sharing-packets-with-collaborators-using-a-shared-file-system">Sharing
packets with collaborators using a shared file system</a> for more
details</li>
<li>
<code>http</code>: these require running an HTTP API, either via <a href="https://github.com/mrc-ide/outpack_server" class="external-link"><code>outpack_server</code></a>
or <a href="https://github.com/mrc-ide/packit" class="external-link"><code>packit</code></a>
</li>
</ul>
<p>The location system is somewhat extensible, but the details of this
are subject to change.</p>
<p>All the documentation below will behave the same regardless of where
the location is stored and the mechanism of transport, so we can focus
instead on workflows.</p>
</div>
<div class="section level2">
<h2 id="an-example">An example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/orderly2" class="external-link">orderly2</a></span><span class="op">)</span></span></code></pre></div>
<p>Suppose we have two researchers, <a href="https://en.wikipedia.org/wiki/Alice_and_Bob" class="external-link">Alice and Bob</a>,
who are collaborating on a piece of analysis. For the purposes of this
example (and we find the most common situation in practice) they share a
source tree with their analysis in git.
<!-- The source for the repository that they are using is on GitHub as
[`reside-ic/orderly-example`](https://github.com/reside-ic/orderly-example).
--></p>
<p>Both Alice and Bob clone this repo onto their machines, using their
favourite git client (at the terminal with <code>git</code>, via GitHub
desktop, or as here with <a href="https://r-lib.github.io/gert" class="external-link"><code>gert</code></a>)</p>
<p>At the moment, including hidden files (except <code>.git</code>),
Alice sees:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">path_alice</span>, all <span class="op">=</span> <span class="cn">TRUE</span>, glob <span class="op">=</span> <span class="st">".git"</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #0000BB; font-weight: bold;">/tmp/RtmpzyI58v/file20e771f4c2e9/alice</span></span></span>
<span><span class="co">## ├── <span style="color: #0000BB; font-weight: bold;">.git</span></span></span>
<span><span class="co">## │   ├── FETCH_HEAD</span></span>
<span><span class="co">## │   ├── HEAD</span></span>
<span><span class="co">## │   ├── config</span></span>
<span><span class="co">## │   ├── description</span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">hooks</span></span></span>
<span><span class="co">## │   │   └── <span style="color: #00BB00; font-weight: bold;">README.sample</span></span></span>
<span><span class="co">## │   ├── index</span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">info</span></span></span>
<span><span class="co">## │   │   └── exclude</span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">logs</span></span></span>
<span><span class="co">## │   │   ├── HEAD</span></span>
<span><span class="co">## │   │   └── <span style="color: #0000BB; font-weight: bold;">refs</span></span></span>
<span><span class="co">## │   │       ├── <span style="color: #0000BB; font-weight: bold;">heads</span></span></span>
<span><span class="co">## │   │       │   └── main</span></span>
<span><span class="co">## │   │       └── <span style="color: #0000BB; font-weight: bold;">remotes</span></span></span>
<span><span class="co">## │   │           └── <span style="color: #0000BB; font-weight: bold;">origin</span></span></span>
<span><span class="co">## │   │               └── main</span></span>
<span><span class="co">## │   ├── <span style="color: #0000BB; font-weight: bold;">objects</span></span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">34</span></span></span>
<span><span class="co">## │   │   │   └── 7dff1935264237e05312c44bf04a751d10d488</span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">49</span></span></span>
<span><span class="co">## │   │   │   └── c1e28eba0e4aa6c9a5ea757ab0413717ead771</span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">81</span></span></span>
<span><span class="co">## │   │   │   └── 98e562c9b5c9af26aa54f4bb04c7aa0fb5735e</span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">99</span></span></span>
<span><span class="co">## │   │   │   └── 13a467958c2e6cfeaec7b896b6266b42507ae6</span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">da</span></span></span>
<span><span class="co">## │   │   │   └── 368e53e01c1f8f7c2572a2018dc21fb677ce87</span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">ee</span></span></span>
<span><span class="co">## │   │   │   └── 5a435d6a38407cb921a1e942cc502c9e2896df</span></span>
<span><span class="co">## │   │   ├── <span style="color: #0000BB; font-weight: bold;">info</span></span></span>
<span><span class="co">## │   │   └── <span style="color: #0000BB; font-weight: bold;">pack</span></span></span>
<span><span class="co">## │   └── <span style="color: #0000BB; font-weight: bold;">refs</span></span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">heads</span></span></span>
<span><span class="co">## │       │   └── main</span></span>
<span><span class="co">## │       ├── <span style="color: #0000BB; font-weight: bold;">remotes</span></span></span>
<span><span class="co">## │       │   └── <span style="color: #0000BB; font-weight: bold;">origin</span></span></span>
<span><span class="co">## │       │       ├── HEAD</span></span>
<span><span class="co">## │       │       └── main</span></span>
<span><span class="co">## │       └── <span style="color: #0000BB; font-weight: bold;">tags</span></span></span>
<span><span class="co">## ├── orderly_config.yml</span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">src</span></span></span>
<span><span class="co">##     └── <span style="color: #0000BB; font-weight: bold;">data</span></span></span>
<span><span class="co">##         └── <span style="color: #00BB00;">data.R</span></span></span></code></pre></div>
<p>At this point, after cloning Alice does not have the
<code>.outpack</code> directory (see below)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_list_src.html">orderly_list_src</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "data"</span></span></code></pre></div>
<p>Alice needs to run <code>orderly::orderly_init()</code> first:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_init.html">orderly_init</a></span><span class="op">(</span><span class="va">path_alice</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/RtmpzyI58v/file20e771f4c2e9/alice'</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Wrote '.gitignore'</span></span></code></pre></div>
<p>after which Alice can use orderly commands:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_list_src.html">orderly_list_src</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "data"</span></span></code></pre></div>
<p>The plan is to work with Bob, sharing results on their shared “<a href="https://github.com/mrc-ide/packit" class="external-link">Packit</a>” server, so Alice
adds that to her <code>orderly2</code> configuration with
<code><a href="../reference/orderly_location_add.html">orderly2::orderly_location_add_packit()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_add.html">orderly_location_add_packit</a></span><span class="op">(</span><span class="st">"server"</span>, <span class="st">"http://packit.example.com"</span><span class="op">)</span></span></code></pre></div>
<p>Once done, she can run any analysis:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20250901-150657-9b26d59e` at 2025-09-01 15:06:57.611912</span></span>
<span><span class="co">## &gt; orderly_artefact("data.rds", description = "Final data")</span></span>
<span><span class="co">## &gt; saveRDS(mtcars, "data.rds")</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Finished 20250901-150657-9b26d59e at 2025-09-01 15:06:57.672147 (0.06023407 secs)</span></span></code></pre></div>
<p>Perhaps it takes several goes for Alice to be happy with the
analysis, but at some point she has something ready to share. She can
then “push” the final packet up onto their server:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_push.html">orderly_location_push</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"server"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Pushing 2 files for 1 packet</span></span>
<span><span class="co">## ⠙ Pushing file 1 / 2 (85 B)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Uploaded 2 files in 17ms</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Fetching metadata from 1 location: 'server'</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Found 1 packet at 'server', of which 0 are new</span></span></code></pre></div>
<p>Now, consider Bob. He also needs the source code cloned, orderly
initialised, and the server added:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_init.html">orderly_init</a></span><span class="op">(</span><span class="va">path_bob</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/RtmpzyI58v/file20e771f4c2e9/bob'</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Wrote '.gitignore'</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_add.html">orderly_location_add_packit</a></span><span class="op">(</span><span class="st">"server"</span>, <span class="st">"http://packit.example.com"</span><span class="op">)</span></span></code></pre></div>
<p>(Here, Bob has also used the name <code>server</code> to refer to
their shared server, but could have used anything; this is similar to
git’s use of <code>origin</code>.)</p>
<p>Bob can now query for packets available on the server:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_metadata_extract.html">orderly_metadata_extract</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  allow_remote <span class="op">=</span> <span class="cn">TRUE</span>, fetch_metadata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Fetching metadata from 1 location: 'server'</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Found 1 packet at 'server', of which 1 is new</span></span>
<span><span class="co">##                         id local location name parameters</span></span>
<span><span class="co">## 1 20250901-150657-9b26d59e FALSE   server data</span></span></code></pre></div>
<p>Having seen there is a new “data” packet here, he can pull this down
locally (TODO: mrc-4414 makes this nicer):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_pull.html">orderly_location_pull</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Pulling 1 packet: '20250901-150657-9b26d59e'</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Looking for suitable files already on disk</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Need to fetch 2 files (1.3 kB) from 1 location</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Unpacked 1 packet</span></span></code></pre></div>
<p>Now Bob is in a position to develop against the same packet that
Alice ran (20250901-150657-9b26d59e)</p>
</div>
<div class="section level2">
<h2 id="possible-working-patterns">Possible working patterns<a class="anchor" aria-label="anchor" href="#possible-working-patterns"></a>
</h2>
<p>We have seen several broad patterns of distributing packets.</p>
<p><strong>Central server, push allowed</strong>: This is the case as
above; this is very flexible but requires that everyone is relaxed about
how packets are created as you are ultimately trusting that your
colleagues are exercising good environment hygiene. Just because rules
are not being enforced by the computer though, doesn’t mean that you
might not have ideas within the group about who can or should push. It
may be useful to only push from your HPC system after running
computationally demanding tasks there.</p>
<p><strong>Central server, final copy is run here</strong>: In this
case, Alice and Bob can both run things on the server, and these are the
“canonical” copies, nothing is pushed to the server. Reports can be run
on the server by <code>ssh</code>-ing onto the server and running
packets manually (TODO: mrc-4412) or using the web interface (this was
possible with <code>OrderlyWeb</code> and will be possible again with
<code>packit</code>).</p>
<p>This approach works well where a primary goal is confidence that the
packets everyone works with as dependencies are created under a “clean”
environment with no unexpected global dependencies. With the web
version, you can also enforce things like only running off the default
branch. Alice and Bob will then end up with a collection of packets in
their local archives that are a mix of canonical ones (from the server)
and locally-created ones, but the local ones are always a dead end as
they never get shared with anyone. As a result, Alice and Bob may delete
their archive directories without any great concern.</p>
<p>When running their own packets, to make sure that the packet will run
in a similar way to a packet run on the server, Bob may want to ensure
that only dependencies that could be found on the server will be
considered. To that, he can pass the <code>location</code> argument to
<code><a href="../reference/orderly_run.html">orderly_run()</a></code>, which controls how search is performed:</p>
<p><code>{.r, as="bob"} orderly_run(..., location = "server")</code></p>
<p>and then pass this in to <code><a href="../reference/orderly_run.html">orderly2::orderly_run</a></code> when
running a report. In developing, Bob may find passing this into
<code><a href="../reference/orderly_interactive_set_search_options.html">orderly2::orderly_interactive_set_search_options()</a></code> helpful
as that will mean that any calls to
<code><a href="../reference/orderly_description.html">orderly2::orderly_description()</a></code> will use only packets from
the server.</p>
<p><strong>Staging and production servers</strong>: You might set up
multiple servers, one or more for staging, and one for production. The
staging servers are never the source of truth and you might (or might
not) allow people to push to them, or have less strict rules about what
gets run on them (perhaps allowing running packets from a feature
branch). In this setting, users will end up with packets that were
created locally, from staging machines and from the production server in
their local archive. The staging server will probably end up with a mix
of its own packets and packets from production. The same approach with
specifying search options as above will be useful here for choosing what
is included in any final packet.</p>
</div>
<div class="section level2">
<h2 id="pulling-complete-trees-or-not">Pulling complete trees, or not<a class="anchor" aria-label="anchor" href="#pulling-complete-trees-or-not"></a>
</h2>
<p>When you pull packets from a server (with
<code><a href="../reference/orderly_location_pull.html">orderly2::orderly_location_pull()</a></code>), depending on your
settings you will either end up with just the packet that you request,
or that packet <strong>plus</strong> all of its recursive dependencies.
This is controlled by the configuration option
<code>core.require_complete_tree</code>, which is <code>FALSE</code> by
default; this is suitable for most users, but servers should be set with
<code>core.require_complete_tree = TRUE</code>.</p>
<p>In most of the situations above, the users are never holding the
canonical source of the packets - so it does not matter if they don’t
have all if their dependencies. They do hold all the metadata for all
packets (again, recursively) and could download the dependencies later
if they wanted to inspect them. Typically though, this would just be
extra space used up on disk.</p>
<p>When you push a packet to a server, it always pushes the complete
tree.</p>
</div>
<div class="section level2">
<h2 id="moving-as-little-data-as-possible">Moving as little data as possible<a class="anchor" aria-label="anchor" href="#moving-as-little-data-as-possible"></a>
</h2>
<p>When pulling packets, first the user pulls metadata from the server.
When <code>orderly2::orderly_location_metadata_pull</code> is run, all
metadata from the server is updated on the client (mrc-4444 will make
this lazier). We now know everything the server holds, and the hashes of
all the files contained in each packet.</p>
<p>It is very likely that we already know of some of the files within a
packet being requested, so the client first looks to see if these exist
within its archive, verifying that they have not been changed. It then
requests from the server all the files that it cannot resolve locally.
If doing a recursive pull (with
<code>core.require_complete_tree = TRUE</code>) then we look at the
union over all files in the set of packets that are currently missing
from our archive. This is frequently much less than the full set of
files within the packets.</p>
<p>The algorithm is similar for a push:</p>
<ul>
<li>look at the full dependency chain of our target packet and find all
file ids and ask the server which if these it does not yet know
about</li>
<li>in the unknown subset we get the union of file hashes and ask the
server which subset of files it does not yet know about</li>
<li>we then push up files - this is done one at a time at present but
could be done simultaneously with async requests in future</li>
<li>once all files are on the sever we upload the missing metadata, in
chronological order and the server verifies that for each packet it has
metadata for all dependencies and all referenced files</li>
</ul>
<p>This multi-step process means that we avoid copying data that is
already known about, as well as avoiding moving the same data multiple
times. It also means that if the process of pushing (or pulling) is
interrupted it can be safely resumed as the state is always
consistent.</p>
</div>
<div class="section level2">
<h2 id="interaction-between-source-tree-and--outpack">Interaction between source tree and <code>.outpack</code><a class="anchor" aria-label="anchor" href="#interaction-between-source-tree-and--outpack"></a>
</h2>
<p>It is important that the <code>.outpack</code> directory is
<em>not</em> shared via git; we warn about this now, and you can use
<code>orderly2::ordery_gitignore_update()</code> to automatically create
a suitable <code>.gitignore</code> file that will prevent it being
accidentally committed.</p>
<p>However,</p>
<p>If Alice and Bob were starting on a new machine they would:</p>
<ul>
<li>clone their source repository</li>
<li>run <code><a href="../reference/orderly_init.html">orderly2::orderly_init()</a></code> from within the
directory</li>
<li>run <code>orderly2</code> commands as normal</li>
</ul>
<p>Without running <code><a href="../reference/orderly_init.html">orderly2::orderly_init()</a></code>, they will get
an error prompting them to initialise the repo.</p>
<p>There is no requirement for different repositories to share
configuration options passed to <code><a href="../reference/orderly_init.html">orderly2::orderly_init()</a></code>;
so you can enable or disable the file store or have different sets of
locations enabled, depending on your workflows. This means that there
is, in practice, only an association <em>by convention</em> between a
set of related <code>orderly2</code> locations and their source tree and
you can have an <code>orderly2</code> repository that points at
locations that refer to different source trees!</p>
</div>
<div class="section level2">
<h2 id="sharing-packets-with-collaborators-using-a-shared-file-system">Sharing packets with collaborators using a shared file system<a class="anchor" aria-label="anchor" href="#sharing-packets-with-collaborators-using-a-shared-file-system"></a>
</h2>
<p>One of the simplest ways to share packets with a collaborator is
through a shared file system, for example on a network share, or on a
cloud-synced file system such as Dropbox or OneDrive. You can do this as
follows.</p>
<ol style="list-style-type: decimal">
<li>Create a a new folder for your orderly remote in the shared file
system. Here Alice has synced to
<code>path_sharepoint_alice</code>.</li>
<li>Initialise an orderly location on the shared file system</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_init.html">orderly_init</a></span><span class="op">(</span></span>
<span>  root <span class="op">=</span> <span class="va">path_sharepoint_alice</span>,</span>
<span>  path_archive <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_file_store <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  require_complete_tree <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/RtmpzyI58v/file20e771f4c2e9/sharepoint'</span></span></code></pre></div>
<p>which creates an orderly store with a file store and a complete tree.
See <code><a href="../reference/orderly_init.html">orderly2::orderly_init()</a></code> for more details.</p>
<ol start="3" style="list-style-type: decimal">
<li>Add this as a location</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_add.html">orderly_location_add_path</a></span><span class="op">(</span><span class="st">"sharepoint"</span>, path <span class="op">=</span> <span class="va">path_sharepoint_alice</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Testing location</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Location configured successfully</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Added location 'sharepoint' (path)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Push any packets you want to share</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_push.html">orderly_location_push</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"sharepoint"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Pushing 2 files for 1 packet</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Fetching metadata from 1 location: 'sharepoint'</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Found 1 packet at 'sharepoint', of which 0 are new</span></span></code></pre></div>
<p>Then these will be available for your collaborator to pull. Note that
the data is pushed into a file store in the <code>.outpack</code>
directory. <code>.dot</code> files are considered hidden by your
operating system, so if you have “show hidden files” off in your file
browser you will not see the pushed packet. But your collaborator can
now pull the shared file. To do so, they will have to:</p>
<ol style="list-style-type: decimal">
<li><p>Sync the same drive to a location on their machine. Here Bob has
synced to <code>path_sharepoint_bob</code></p></li>
<li><p>Add the location</p></li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_add.html">orderly_location_add_path</a></span><span class="op">(</span><span class="st">"alices_orderly"</span>, <span class="va">path_sharepoint_bob</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Testing location</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Location configured successfully</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Added location 'alices_orderly' (path)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Pull the metadata and use the packets as desired</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_location_fetch_metadata.html">orderly_location_fetch_metadata</a></span><span class="op">(</span><span class="st">"alices_orderly"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Fetching metadata from 1 location: 'alices_orderly'</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Found 1 packet at 'alices_orderly', of which 0 are new</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
