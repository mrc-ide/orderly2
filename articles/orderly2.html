<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>orderly2 • orderly2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="orderly2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.99.81</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/orderly2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly2</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>orderly2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly2/blob/main/vignettes/orderly2.Rmd" class="external-link"><code>vignettes/orderly2.Rmd</code></a></small>
      <div class="d-none name"><code>orderly2.Rmd</code></div>
    </div>

    
    
<p><code>orderly2</code> is a package designed with two complementary
goals in mind:</p>
<ol style="list-style-type: decimal">
<li>to make analyses reproducible without significant effort on the part
of the analyst</li>
<li>to make it easy to collaborate on analyses by allowing easy sharing
of artefacts from an analysis amongst a group of analysts.</li>
</ol>
<p>In this vignette we will expand on these two aims, and show that the
first one is a prerequisite for the second. The second is more
interesting though and we start there. If you just want to get started
using <code>orderly2</code>, you might prefer
<code><a href="../articles/introduction.html">vignette("introduction")</a></code> and if you are already familiar
with version 1 you might prefer <code><a href="../articles/migrating.html">vignette("migrating")</a></code>.</p>
<div class="section level2">
<h2 id="collaborative-analysis">Collaborative analysis<a class="anchor" aria-label="anchor" href="#collaborative-analysis"></a>
</h2>
<p>Many analyses only involve a single person and a single machine; in
this case there are any number of workflow tools that will make
orchestrating this analysis easy. In a workflow model you have a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" class="external-link"><em>graph</em></a>
of dependencies over your analysis, over which data flows. So for
example you might have</p>
<pre><code>[raw data] -&gt; [processed data] -&gt; [model fits] -&gt; [forecasts] -&gt; [report]</code></pre>
<p>If you update the data, the whole pipeline should rerun. But if you
update the code for the forecast, then only the forecasts and report
should rerun.</p>
<p>In our experience, this model works well for a single-user setting
but falls over in a collaborative setting, especially where the analysis
is partitioned by person; so Alice is handling the data pipeline, Bob is
running fits, while Carol is organising forecasts and the final report.
In this context, changes upstream affect downstream analysis, and
require the same sort of care around integration as you might be used to
with version controlling source code.</p>
<p>For example, if Alice is dealing with a change in the incoming data
format which is going to break the analysis at the same time that Bob is
trying to get the model fits working, Bob should not be trying to
integrate both his code changes <em>and</em> Alice’s new data. We
typically deal with this for source code by using branches within git;
for the code Bob would work on a branch that is isolated from Alice’s
changes. But in most contexts like this you will not have (and
<em>should not have</em>) the data and analysis products in git. What is
needed is a way of versioning the outputs of each step of analysis and
controlling when these are integrated into subsequent analyses.</p>
<p>Another way of looking at the problem is that we seek a way of making
analysis <strong>composable</strong> in the same way that functions and
OOP achieve for programs, or the way that docker and containerisation
have achieved for deploying software. To do this we need a way of
putting interfaces around pieces of analysis and to allow people to
refer to them and fetch them from somewhere where they have been
run.</p>
<p>The conceptual pieces that are needed here are:</p>
<ul>
<li>some way of referring unambiguously (and globally) to a piece of
analysis so that it can be depended upon, and so that everyone can agree
they’re talking about the same piece of analysis</li>
<li>a system of storage so that results of running analysis can be
shared among a group</li>
<li>a system to control how integration of these pieces of analysis
takes place</li>
</ul>
<p>We refer to a transportable unit of analysis as a “packet”. This
conceptually is a directory of files created by running some code, and
is our atomic unit of work from the point of view of
<code>orderly</code>. Each packet has an underlying source form, which
anyone <em>can</em> run. However, most of the time people will use
pre-run packets that they or their collaborators have run as inputs to
onward analyses (see <code><a href="../articles/dependencies.html">vignette("dependencies")</a></code> and
<code><a href="../articles/collaboration.html">vignette("collaboration")</a></code> for more details).</p>
</div>
<div class="section level2">
<h2 id="reproducible-analyses">Reproducible analyses<a class="anchor" aria-label="anchor" href="#reproducible-analyses"></a>
</h2>
<p>Any degree of collaboration in the style above requires
reproducibility, but there are several aspects of this.</p>
<p>With the system we describe here, even though everyone <em>can</em>
typically run any step of an analysis, they typically <em>don’t</em>.
This differs from workflow tools, which users may be familiar with.</p>
<div class="section level3">
<h3 id="difference-from-a-workflow-system">Difference from a workflow system<a class="anchor" aria-label="anchor" href="#difference-from-a-workflow-system"></a>
</h3>
<p>Workflow systems have been hugely influential in scientific
computing, from people co-opting build systems like <a href="https://en.wikipedia.org/wiki/Make_(software)" class="external-link">make</a> through to
sophisticated systems designed for parallel running of large and complex
workflows such as <a href="https://www.nextflow.io/" class="external-link">nextflow</a>. The
general approach is to define interdependencies among parts of an
analysis, forming a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" class="external-link"><em>graph</em></a>
over parts of an analysis and track inputs and outputs through the
workflow.</p>
<p>This model of computation has lots of good points:</p>
<ul>
<li>it defines an interface over an analysis and allows (and encourages)
breaking a monolithic analysis into component pieces which can be
reasoned about</li>
<li>it allows high-level parallelism by making obvious parts of the
workflow that can be run concurrently</li>
<li>by tracking the way data flows through an analysis, it allows the
minimum amount of recalculation to be done on change, with only
downstream parts triggered</li>
<li>with a shared workspace or online runner, allows a degree of
collaboration so long as everyone is happy to be working with a
constantly changing set of code and analysis artefacts</li>
</ul>
<p>We have designed <code>orderly2</code> for working patterns that do
not suit the above. Some motivating reasons include:</p>
<ul>
<li>Some nodes in the computational graph are very expensive to compute
or require exotic hardware.</li>
<li>Workflows where the upstream data never settle, but we need to know
which version of the data ends up used in a particular analysis</li>
<li>Workflows where upstream analyses are used in many downstream
analyses, and where the upstream developer may not know much about the
downstream use</li>
<li>Nondeterministic analyses, e.g., those involving stochastic
simulations, where rerunning a node is not expected to return the exact
same numerical results, and so we can’t rely on different users
recovering the same results on different occasions[*]</li>
</ul>
<p>In all these cases the missing piece we need is a way of versioning
the nodes within the computational graph, and shifting the emphasis from
automatically rerunning portions of the graph to tracking how data has
flowed through the graph. This in turn shifts the reproducibility
emphasis from “everyone <em>will</em> run the same code and get the same
results” to “everyone <em>could</em> run the same code, but will instead
work with the results”.</p>
<p>For those familiar with docker, our approach is similar to working
with pre-built docker images, whereas the workflow approach is more
similar to working directly with Dockerfiles; in many situations the end
result is the same, but the approaches differ in guarantees, in where
the computation happens, and in how users refer to versions.</p>
<p><small> [*] We discourage trying to force determinism by manually
setting seeds, as this has the potential to violate the statistical
properties of random number streams, and is fragile at best.
</small></p>
</div>
<div class="section level3">
<h3 id="what-is-reproducibility-anyway">What is reproducibility anyway?<a class="anchor" aria-label="anchor" href="#what-is-reproducibility-anyway"></a>
</h3>
<p>Reproducibility means different things to different people, even
within the narrow sense of “rerun an analysis and retrieve the same
results”. In the last decade, the idea that one should be <em>able</em>
to rerun a piece of analysis and retrieve the same results has slightly
morphed into one <em>must</em> rerun a piece of analysis. Similarly, the
emphasis on the utility of reproducibility has shifted from authors
being able to rerun their own work (or have confidence that they could
rerun it) to some hypothetical third party wanting to rerun an
analysis.</p>
<p>Our approach flips the perspective around a bit, based on our
experiences with collaborative research projects, and draws from an
(overly) ambitious aim we had:</p>
<blockquote>
<p>Can we prove that a given set of inputs produced a given set of
outputs?</p>
</blockquote>
<p>We quickly found that this was impossible, but provided a few systems
were in place one could be satisfied with this statement to a given
level of trust in a system. So if a piece of analysis comes from a
server where the primary way people run analyses is through our web
front-end (currently <a href="https://github.com/mrc-ide/orderly-web" class="external-link">OrderlyWeb</a>, soon to be
<a href="https://github.com/mrc-ide/packit" class="external-link">Packit</a>) we <em>know</em>
that the analysis was run end-to-end with no modification and that
<code>orderly2</code> preserves inputs alongside outputs so the files
that are present in the final packet <strong>were</strong> the files
that went into the analysis, and the recorded R and package versions
<strong>were</strong> the full set that were used.</p>
<p>Because this system naturally involves running on multiple machines
(typically we will have the analysts’ laptops, a server and perhaps an
HPC environment), and because of the way that <code>orderly2</code>
treats paths, practically there is very little problem getting analyses
working in multiple places, trivially satisfying the typical
reproducibility aim, even though it is not what people are typically
focussed on.</p>
<p>This shift in focus has proved valuable. In any analysis that is run
on more than one occasion (e.g., regular reporting, or simply updating a
figure for a final submission of a manuscript after revision), the
outputs may change. Understanding <em>why</em> these changes have
happened is important. Because <code>orderly2</code> automatically saves
a lot of metadata about what was run it is easy to find out why things
might have changed. Further, you can start interrogating the graph among
packets to find out what effect that change has had; so find all the
previously run packets that pulled in the old version of a data set, or
that used the previous release of a package.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
